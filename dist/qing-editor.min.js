/* qing-editor v0.0.1 | (c) Mycolorway Design | MIT License */
!function(t,e){"object"==typeof module&&module.exports?module.exports=e(require("jquery"),require("qing-module"),require("qing-uploader")):t.QingEditor=e(t.jQuery,t.QingModule,t.QingUploader)}(this,function(t,e,n){var o=require=function t(e,n,o){function r(s,a){if(!n[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var p=n[s]={exports:{}};e[s][0].call(p.exports,function(t){var n=e[s][1][t];return r(n?n:t)},p,p.exports,t,e,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(t,e,n){var o,r,i=function(t,e){function n(){this.constructor=t}for(var o in e)s.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},s={}.hasOwnProperty;r=t("./button.coffee"),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.name="alignment",e.prototype.icon="align-left",e.prototype.htmlTag="p, h1, h2, h3, h4, td, th",e.prototype._init=function(){return this.menu=[{name:"left",text:this._t("alignLeft"),icon:"align-left",param:"left"},{name:"center",text:this._t("alignCenter"),icon:"align-center",param:"center"},{name:"right",text:this._t("alignRight"),icon:"align-right",param:"right"}],e.__super__._init.apply(this,arguments)},e.prototype.setActive=function(t,n){return null==n&&(n="left"),"left"!==n&&"center"!==n&&"right"!==n&&(n="left"),"left"===n?e.__super__.setActive.call(this,!1):e.__super__.setActive.call(this,t),this.el.removeClass("align-left align-center align-right"),t&&this.el.addClass("align-"+n),this.setIcon("align-"+n),this.menuEl.find(".menu-item").show().end().find(".menu-item-"+n).hide()},e.prototype._status=function(){return this.nodes=this.editor.selection.nodes().filter(this.htmlTag),this.nodes.length<1?(this.setDisabled(!0),this.setActive(!1)):(this.setDisabled(!1),this.setActive(!0,this.nodes.first().css("text-align")))},e.prototype.command=function(t){if("left"!==t&&"center"!==t&&"right"!==t)throw new Error("qing-editor alignment button: invalid align "+t);return this.nodes.css({"text-align":"left"===t?"":t}),this.editor.trigger("valuechanged"),this.editor.inputManager.throttledSelectionChanged()},e}(r),e.exports=o},{"./button.coffee":4}],2:[function(e,n,o){var r,i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;i=e("./button.coffee"),r=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.prototype.name="blockquote",n.prototype.icon="quote-left",n.prototype.htmlTag="blockquote",n.prototype.disableTag="pre, table",n.prototype.command=function(){var e,n,o;return e=this.editor.selection.rootNodes(),e=e.filter(function(e,n){return!t(n).parent().is("blockquote")}),this.editor.selection.save(),o=[],n=function(e){return function(){if(o.length>0)return t("<"+e.htmlTag+"/>").insertBefore(o[0]).append(o),o.length=0}}(this),e.each(function(e){return function(r,i){var s;if(s=t(i),s.parent().is(e.editor.body))return s.is(e.htmlTag)?(n(),s.children().unwrap()):s.is(e.disableTag)||e.editor.util.isDecoratedNode(s)?n():o.push(i)}}(this)),n(),this.editor.selection.restore(),this.editor.trigger("valuechanged")},n}(i),n.exports=r},{"./button.coffee":4}],3:[function(e,n,o){var r,i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;i=e("./button.coffee"),r=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.prototype.name="bold",n.prototype.icon="bold",n.prototype.htmlTag="b, strong",n.prototype.disableTag="pre",n.prototype.shortcut="cmd+b",n.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + b )":(this.title=this.title+" ( Ctrl + b )",this.shortcut="ctrl+b"),n.__super__._init.apply(this,arguments)},n.prototype._activeStatus=function(){var t;return t=document.queryCommandState("bold")===!0,this.setActive(t),this.active},n.prototype.command=function(){return document.execCommand("bold"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),t(document).trigger("selectionchange")},n}(i),n.exports=r},{"./button.coffee":4}],4:[function(n,o,r){var i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.opts={editor:null,locales:null},n.prototype._tpl={item:'<li><a tabindex="-1" unselectable="on" class="toolbar-item" href="javascript:;"><span></span></a></li>',menuWrapper:'<div class="toolbar-menu"></div>',menuItem:'<li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;"><span></span></a></li>',separator:'<li><span class="separator"></span></li>'},n.prototype.name="",n.prototype.icon="",n.prototype.title="",n.prototype.text="",n.prototype.htmlTag="",n.prototype.disableTag="",n.prototype.menu=!1,n.prototype.active=!1,n.prototype.disabled=!1,n.prototype.needFocus=!0,n.prototype.shortcut=null,n.prototype._setOptions=function(e){return n.__super__._setOptions.apply(this,arguments),t.extend(this.opts,n.opts,e),this.editor=this.opts.editor,this.toolbar=this.opts.toolbar},n.prototype._init=function(){var e,n,o,r;for(this.title=this._t(this.name),this.render(),this.el.on("mousedown",function(t){return function(e){var n,o,r;return e.preventDefault(),o=t.needFocus&&!t.editor.inputManager.focused,!t.el.hasClass("disabled")&&!o&&(t.menu?(t.wrapper.toggleClass("menu-on").siblings("li").removeClass("menu-on"),t.wrapper.is(".menu-on")&&(n=t.menuWrapper.offset().left+t.menuWrapper.outerWidth()+5-t.editor.wrapper.offset().left-t.editor.wrapper.outerWidth(),n>0&&t.menuWrapper.css({left:"auto",right:0}),t.trigger("menuexpand")),!1):(r=t.el.data("param"),t.command(r),!1))}}(this)),this.wrapper.on("click","a.menu-item",function(e){return function(n){var o,r,i;return n.preventDefault(),o=t(n.currentTarget),e.wrapper.removeClass("menu-on"),r=e.needFocus&&!e.editor.inputManager.focused,!o.hasClass("disabled")&&!r&&(e.toolbar.wrapper.removeClass("menu-on"),i=o.data("param"),e.command(i),!1)}}(this)),this.wrapper.on("mousedown","a.menu-item",function(t){return!1}),this.editor.on("blur",function(t){return function(){var e;if(e=t.editor.body.is(":visible")&&t.editor.body.is("[contenteditable]"),e&&!t.editor.clipboard.pasting)return t.setActive(!1),t.setDisabled(!1)}}(this)),null!=this.shortcut&&this.editor.hotkeys.add(this.shortcut,function(t){return function(e){return t.el.mousedown(),!1}}(this)),o=this.htmlTag.split(","),e=0,n=o.length;e<n;e++)r=o[e],r=t.trim(r),r&&t.inArray(r,this.editor.formatter._allowedTags)<0&&this.editor.formatter._allowedTags.push(r);return this.editor.on("selectionchanged",function(t){return function(e){if(t.editor.inputManager.focused)return t._status()}}(this))},n.prototype.iconClassOf=function(t){return t?"qing-editor-icon qing-editor-icon-"+t:""},n.prototype.setIcon=function(t){return this.el.find("span").removeClass().addClass(this.iconClassOf(t)).text(this.text)},n.prototype.render=function(){if(this.wrapper=t(this._tpl.item).appendTo(this.toolbar.list),this.el=this.wrapper.find("a.toolbar-item"),this.el.attr("title",this.title).addClass("toolbar-item-"+this.name).data("button",this),this.setIcon(this.icon),this.menu)return this.menuWrapper=t(this._tpl.menuWrapper).appendTo(this.wrapper),this.menuWrapper.addClass("toolbar-menu-"+this.name),this.renderMenu()},n.prototype.renderMenu=function(){var e,n,o,r,i,s,a,l;if(t.isArray(this.menu)){for(this.menuEl=t("<ul/>").appendTo(this.menuWrapper),s=this.menu,l=[],o=0,r=s.length;o<r;o++)i=s[o],"|"!==i?(n=t(this._tpl.menuItem).appendTo(this.menuEl),e=n.find("a.menu-item").attr({title:null!=(a=i.title)?a:i.text,"data-param":i.param}).addClass("menu-item-"+i.name),i.icon?l.push(e.find("span").addClass(this.iconClassOf(i.icon))):l.push(e.find("span").text(i.text))):t(this._tpl.separator).appendTo(this.menuEl);return l}},n.prototype.setActive=function(t){if(t!==this.active)return this.active=t,this.el.toggleClass("active",this.active)},n.prototype.setDisabled=function(t){if(t!==this.disabled)return this.disabled=t,this.el.toggleClass("disabled",this.disabled)},n.prototype._disableStatus=function(){var t,e,n;return n=this.editor.selection.startNodes(),e=this.editor.selection.endNodes(),t=n.filter(this.disableTag).length>0||e.filter(this.disableTag).length>0,this.setDisabled(t),this.disabled&&this.setActive(!1),this.disabled},n.prototype._activeStatus=function(){var t,e,n,o,r;return r=this.editor.selection.startNodes(),n=this.editor.selection.endNodes(),o=r.filter(this.htmlTag),e=n.filter(this.htmlTag),t=o.length>0&&e.length>0&&o.is(e),this.node=t?o:null,this.setActive(t),this.active},n.prototype._status=function(){if(this._disableStatus(),!this.disabled)return this._activeStatus()},n.prototype.command=function(t){},n.prototype._t=function(t){return this.opts.locales[t]},n}(e),o.exports=i},{}],5:[function(e,n,o){var r,i,s,a,l=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty,p=[].slice;r=e("./button.coffee"),a=e("./popover.coffee"),i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return l(n,e),n.prototype.name="code",n.prototype.icon="code",n.prototype.htmlTag="pre",n.prototype.disableTag="ul, ol, table",n.prototype._init=function(){return n.__super__._init.apply(this,arguments),this.editor.on("decorate",function(e){return function(n,o){return o.find("pre").each(function(n,o){return e.decorate(t(o))})}}(this)),this.editor.on("undecorate",function(e){return function(n,o){return o.find("pre").each(function(n,o){return e.undecorate(t(o))})}}(this))},n.prototype.render=function(){var t;return t=1<=arguments.length?p.call(arguments,0):[],n.__super__.render.apply(this,t),this.popover=new s({button:this})},n.prototype._checkMode=function(){var e,n;return n=this.editor.selection.range(),(e=t(n.cloneContents()).find(this.editor.util.blockNodes.join(",")))>0||n.collapsed&&0===this.editor.selection.startNodes().filter("code").length?(this.inlineMode=!1,this.htmlTag="pre"):(this.inlineMode=!0,this.htmlTag="code")},n.prototype._status=function(){if(this._checkMode(),n.__super__._status.call(this),!this.inlineMode)return this.active?this.popover.show(this.node):this.popover.hide()},n.prototype.decorate=function(t){var e,n,o,r;if(e=t.find("> code"),e.length>0&&(n=null!=(o=e.attr("class"))&&null!=(r=o.match(/lang-(\S+)/))?r[1]:void 0,e.contents().unwrap(),n))return t.attr("data-lang",n)},n.prototype.undecorate=function(e){var n,o;return o=e.attr("data-lang"),n=t("<code/>"),o&&o!==-1&&n.addClass("lang-"+o),e.wrapInner(n).removeAttr("data-lang")},n.prototype.command=function(){return this.inlineMode?this._inlineCommand():this._blockCommand()},n.prototype._blockCommand=function(){var e,n,o,r;return e=this.editor.selection.rootNodes(),o=[],r=[],n=function(e){return function(){var n;if(o.length>0)return n=t("<"+e.htmlTag+"/>").insertBefore(o[0]).text(e.editor.formatter.clearHtml(o)),r.push(n[0]),o.length=0}}(this),e.each(function(e){return function(i,s){var a,l;return a=t(s),a.is(e.htmlTag)?(n(),l=t("<p/>").append(a.html().replace("\n","<br/>")).replaceAll(a),r.push(l[0])):a.is(e.disableTag)||e.editor.util.isDecoratedNode(a)||a.is("blockquote")?n():o.push(s)}}(this)),n(),this.editor.selection.setRangeAtEndOf(t(r).last()),this.editor.trigger("valuechanged")},n.prototype._inlineCommand=function(){var e,n,o;return o=this.editor.selection.range(),this.active?(o.selectNodeContents(this.node[0]),this.editor.selection.save(o),this.node.contents().unwrap(),this.editor.selection.restore()):(n=t(o.extractContents()),e=t("<"+this.htmlTag+"/>").append(n.contents()),o.insertNode(e[0]),o.selectNodeContents(e[0]),this.editor.selection.range(o)),this.editor.trigger("valuechanged")},n}(r),s=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return l(n,e),n.prototype.render=function(){var e,n,o,r,i;for(this._tpl='<div class="code-settings">\n  <div class="settings-field">\n    <select class="select-lang">\n      <option value="-1">'+this._t("selectLanguage")+"</option>\n    </select>\n  </div>\n</div>",this.langs=this.editor.opts.codeLanguages||[{name:"Bash",value:"bash"},{name:"C++",value:"c++"},{name:"C#",value:"cs"},{name:"CSS",value:"css"},{name:"Erlang",value:"erlang"},{name:"Less",value:"less"},{name:"Sass",value:"sass"},{name:"Diff",value:"diff"},{name:"CoffeeScript",value:"coffeescript"},{name:"HTML,XML",value:"html"},{name:"JSON",value:"json"},{name:"Java",value:"java"},{name:"JavaScript",value:"js"},{name:"Markdown",value:"markdown"},{name:"Objective C",value:"oc"},{name:"PHP",value:"php"},{name:"Perl",value:"parl"},{name:"Python",value:"python"},{name:"Ruby",value:"ruby"},{name:"SQL",value:"sql"}],this.el.addClass("code-popover").append(this._tpl),this.selectEl=this.el.find(".select-lang"),i=this.langs,n=0,r=i.length;n<r;n++)o=i[n],e=t("<option/>",{text:o.name,value:o.value}).appendTo(this.selectEl);return this.selectEl.on("change",function(t){return function(e){var n;return t.lang=t.selectEl.val(),n=t.target.hasClass("selected"),t.target.removeClass().removeAttr("data-lang"),t.lang!==-1&&t.target.attr("data-lang",t.lang),n&&t.target.addClass("selected"),t.editor.trigger("valuechanged")}}(this)),this.editor.on("valuechanged",function(t){return function(e){if(t.active)return t.refresh()}}(this))},n.prototype.show=function(){var t;return t=1<=arguments.length?p.call(arguments,0):[],n.__super__.show.apply(this,t),this.lang=this.target.attr("data-lang"),null!=this.lang?this.selectEl.val(this.lang):this.selectEl.val(-1)},n}(a),n.exports=i},{"./button.coffee":4,"./popover.coffee":16}],6:[function(e,n,o){var r,i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty,l=[].slice;r=e("./button.coffee"),i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.prototype.name="color",n.prototype.icon="tint",n.prototype.disableTag="pre",n.prototype.menu=!0,n.prototype.render=function(){var t;return t=1<=arguments.length?l.call(arguments,0):[],n.__super__.render.apply(this,t)},n.prototype.renderMenu=function(){return t('<ul class="color-list">\n  <li><a href="javascript:;" class="font-color font-color-1"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-2"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-3"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-4"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-5"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-6"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-7"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-default"></a></li>\n</ul>').appendTo(this.menuWrapper),this.menuWrapper.on("mousedown",".color-list",function(t){return!1}),this.menuWrapper.on("click",".font-color",function(e){return function(n){var o,r,i,s,a,l;if(e.wrapper.removeClass("menu-on"),o=t(n.currentTarget),o.hasClass("font-color-default")){if(r=e.editor.body.find("p, li"),!(r.length>0))return;a=window.getComputedStyle(r[0],null).getPropertyValue("color"),i=e._convertRgbToHex(a)}else a=window.getComputedStyle(o[0],null).getPropertyValue("background-color"),i=e._convertRgbToHex(a);if(i)return s=e.editor.selection.range(),!o.hasClass("font-color-default")&&s.collapsed&&(l=document.createTextNode(e._t("coloredText")),s.insertNode(l),s.selectNodeContents(l),e.editor.selection.range(s)),document.execCommand("styleWithCSS",!1,!0),document.execCommand("foreColor",!1,i),document.execCommand("styleWithCSS",!1,!1),e.editor.util.support.oninput?void 0:e.editor.trigger("valuechanged")}}(this))},n.prototype._convertRgbToHex=function(t){var e,n,o;return n=/rgb\((\d+),\s?(\d+),\s?(\d+)\)/g,(e=n.exec(t))?(o=function(t,e,n){var o;return o=function(t){var e;return e=t.toString(16),1===e.length?"0"+e:e},"#"+o(t)+o(e)+o(n)})(1*e[1],1*e[2],1*e[3]):""},n}(r),n.exports=i},{"./button.coffee":4}],7:[function(e,n,o){var r,i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;r=e("./button.coffee"),i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.prototype.name="fontScale",n.prototype.icon="font",n.prototype.disableTag="pre",n.prototype.htmlTag="span",n.prototype.sizeMap={"x-large":"1.5em",large:"1.25em",small:".75em","x-small":".5em"},n.prototype._init=function(){return this.menu=[{name:"150%",text:this._t("fontScaleXLarge"),param:"5"},{name:"125%",text:this._t("fontScaleLarge"),param:"4"},{name:"100%",text:this._t("fontScaleNormal"),param:"3"},{name:"75%",text:this._t("fontScaleSmall"),param:"2"},{name:"50%",text:this._t("fontScaleXSmall"),param:"1"}],n.__super__._init.apply(this,arguments)},n.prototype._activeStatus=function(){var t,e,n,o,r,i;return o=this.editor.selection.range(),i=this.editor.selection.startNodes(),n=this.editor.selection.endNodes(),r=i.filter('span[style*="font-size"]'),e=n.filter('span[style*="font-size"]'),t=i.length>0&&n.length>0&&r.is(e),this.setActive(t),this.active},n.prototype.command=function(e){var n,o,r;if(r=this.editor.selection.range(),!r.collapsed)return document.execCommand("styleWithCSS",!1,!0),document.execCommand("fontSize",!1,e),document.execCommand("styleWithCSS",!1,!1),this.editor.selection.reset(),this.editor.selection.range(),o=this.editor.selection.containerNode(),n=o[0].nodeType===Node.TEXT_NODE?o.closest('span[style*="font-size"]'):o.find('span[style*="font-size"]'),n.each(function(e){return function(n,o){var r,i;return r=t(o),i=o.style.fontSize,/large|x-large|small|x-small/.test(i)?r.css("fontSize",e.sizeMap[i]):"medium"===i?r.replaceWith(r.contents()):void 0}}(this)),this.editor.trigger("valuechanged")},n}(r),n.exports=i},{"./button.coffee":4}],8:[function(e,n,o){var r,i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;r=e("./button.coffee"),i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.prototype.name="hr",n.prototype.icon="minus",n.prototype.htmlTag="hr",n.prototype._status=function(){},n.prototype.command=function(){var e,n,o,r;return r=this.editor.selection.rootNodes().first(),o=r.next(),o.length>0?this.editor.selection.save():n=t("<p/>").append(this.editor.util.phBr),e=t("<hr/>").insertAfter(r),n?(n.insertAfter(e),this.editor.selection.setRangeAtStartOf(n)):this.editor.selection.restore(),this.editor.trigger("valuechanged")},n}(r),n.exports=i},{"./button.coffee":4}],9:[function(e,n,o){var r,i,s,a,l=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty,p=[].slice;r=e("./button.coffee"),a=e("./popover.coffee"),i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return l(n,e),n.prototype.name="image",n.prototype.icon="picture-o",n.prototype.htmlTag="img",n.prototype.disableTag="pre, table",n.prototype.defaultImage="",n.prototype.needFocus=!1,n.prototype._init=function(){var e,o,r,i;if(this.editor.opts.imageButton)if(Array.isArray(this.editor.opts.imageButton))for(this.menu=[],i=this.editor.opts.imageButton,o=0,r=i.length;o<r;o++)e=i[o],this.menu.push({name:e+"-image",text:this._t(e+"Image")});else this.menu=!1;else null!=this.editor.uploader?this.menu=[{name:"upload-image",text:this._t("uploadImage")},{name:"external-image",text:this._t("externalImage")}]:this.menu=!1;return this.defaultImage=this.editor.opts.defaultImage,this.editor.body.on("click","img:not([data-non-image])",function(e){return function(n){var o,r;return o=t(n.currentTarget),r=document.createRange(),r.selectNode(o[0]),e.editor.selection.range(r),e.editor.util.support.onselectionchange||e.editor.trigger("selectionchanged"),!1}}(this)),this.editor.body.on("mouseup","img:not([data-non-image])",function(t){return!1}),this.editor.on("selectionchanged.image",function(e){return function(){var n,o,r;if(r=e.editor.selection.range(),null!=r)return n=t(r.cloneContents()).contents(),1===n.length&&n.is("img:not([data-non-image])")?(o=t(r.startContainer).contents().eq(r.startOffset),e.popover.show(o)):e.popover.hide()}}(this)),this.editor.on("valuechanged.image",function(e){return function(){var n;if(n=e.editor.wrapper.find(".qing-editor-image-loading"),n.length>0)return n.each(function(n,o){var r,i,s;if(i=t(o),r=i.data("img"),!(r&&r.parent().length>0)&&(i.remove(),r&&(s=r.data("file"),s&&(e.editor.uploader.cancel(s),e.editor.body.find("img.uploading").length<1))))return e.editor.uploader.trigger("uploadready",[s])})}}(this)),n.__super__._init.apply(this,arguments)},n.prototype.render=function(){var t;if(t=1<=arguments.length?p.call(arguments,0):[],n.__super__.render.apply(this,t),this.popover=new s({button:this}),"upload"===this.editor.opts.imageButton)return this._initUploader(this.el)},n.prototype.renderMenu=function(){return n.__super__.renderMenu.call(this),this._initUploader()},n.prototype._initUploader=function(e){var n,o,r;return null==e&&(e=this.menuEl.find(".menu-item-upload-image")),null==this.editor.uploader?void this.el.find(".btn-upload").remove():(n=null,o=function(o){return function(){return n&&n.remove(),n=t("<input/>",{type:"file",title:o._t("uploadImage"),multiple:!0,accept:"image/*"}).appendTo(e)}}(this),o(),e.on("click mousedown","input[type=file]",function(t){return t.stopPropagation()}),e.on("change","input[type=file]",function(t){return function(e){return t.editor.inputManager.focused?(t.editor.uploader.upload(n,{inline:!0}),o()):(t.editor.one("focus",function(e){return t.editor.uploader.upload(n,{inline:!0}),o()}),t.editor.focus()),t.wrapper.removeClass("menu-on")}}(this)),this.editor.uploader.on("beforeupload",function(e){return function(n,o){var r;if(o.inline)return o.img?r=t(o.img):(r=e.createImage(o.name),o.img=r),r.addClass("uploading"),r.data("file",o),e.editor.uploader.readImageFile(o.obj,function(t){var n;if(r.hasClass("uploading"))return n=t?t.src:e.defaultImage,e.loadImage(r,n,function(){if(e.popover.active)return e.popover.refresh(),e.popover.srcEl.val(e._t("uploading")).prop("disabled",!0)})})}}(this)),r=t.proxy(this.editor.util.throttle(function(t,e,n,o){var r,i,s;if(e.inline&&(i=e.img.data("mask")))return r=i.data("img"),r.hasClass("uploading")&&r.parent().length>0?(s=n/o,s=(100*s).toFixed(0),s>99&&(s=99),i.find(".progress").height(100-s+"%")):void i.remove()},500),this),this.editor.uploader.on("uploadprogress",r),this.editor.uploader.on("uploadsuccess",function(e){return function(n,o,r){var i,s,a;if(o.inline&&(i=o.img,i.hasClass("uploading")&&i.parent().length>0)){if("object"!=typeof r)try{r=t.parseJSON(r)}catch(t){n=t,r={success:!1}}return r.success===!1?(a=r.msg||e._t("uploadFailed"),alert(a),s=e.defaultImage):s=r.file_path,e.loadImage(i,s,function(){var t;if(i.removeData("file"),i.removeClass("uploading").removeClass("loading"),t=i.data("mask"),t&&t.remove(),i.removeData("mask"),e.editor.trigger("valuechanged"),e.editor.body.find("img.uploading").length<1)return e.editor.uploader.trigger("uploadready",[o,r])}),e.popover.active?(e.popover.srcEl.prop("disabled",!1),e.popover.srcEl.val(r.file_path)):void 0}}}(this)),this.editor.uploader.on("uploaderror",function(e){return function(n,o,r){var i,s,a;if(o.inline&&"abort"!==r.statusText){if(r.responseText){try{a=t.parseJSON(r.responseText),s=a.msg}catch(t){n=t,s=e._t("uploadError")}alert(s)}if(i=o.img,i.hasClass("uploading")&&i.parent().length>0)return e.loadImage(i,e.defaultImage,function(){var t;return i.removeData("file"),i.removeClass("uploading").removeClass("loading"),t=i.data("mask"),t&&t.remove(),i.removeData("mask")}),e.popover.active&&(e.popover.srcEl.prop("disabled",!1),e.popover.srcEl.val(e.defaultImage)),e.editor.trigger("valuechanged"),e.editor.body.find("img.uploading").length<1?e.editor.uploader.trigger("uploadready",[o,a]):void 0}}}(this)))},n.prototype._status=function(){return this._disableStatus()},n.prototype.loadImage=function(e,n,o){var r,i,s;return s=function(t){return function(){var n,o;return n=e.offset(),o=t.editor.wrapper.offset(),r.css({top:n.top-o.top,left:n.left-o.left,width:e.width(),height:e.height()}).show()}}(this),e.addClass("loading"),r=e.data("mask"),r||(r=t('<div class="qing-editor-image-loading">\n  <div class="progress"></div>\n</div>').hide().appendTo(this.editor.wrapper),s(),e.data("mask",r),r.data("img",e)),i=new Image,i.onload=function(a){return function(){var l,u;if(e.hasClass("loading")||e.hasClass("uploading"))return u=i.width,l=i.height,e.attr({src:n,width:u,height:l,"data-image-size":u+","+l}).removeClass("loading"),e.hasClass("uploading")?(a.editor.util.reflow(a.editor.body),s()):(r.remove(),e.removeData("mask")),t.isFunction(o)?o(i):void 0}}(this),i.onerror=function(){return t.isFunction(o)&&o(!1),r.remove(),e.removeData("mask").removeClass("loading")},i.src=n},n.prototype.createImage=function(e){var n,o;return null==e&&(e="Image"),this.editor.inputManager.focused||this.editor.focus(),o=this.editor.selection.range(),o.deleteContents(),this.editor.selection.range(o),n=t("<img/>").attr("alt",e),o.insertNode(n[0]),this.editor.selection.setRangeAfter(n,o),this.editor.trigger("valuechanged"),n},n.prototype.command=function(t){var e;return e=this.createImage(),this.loadImage(e,t||this.defaultImage,function(t){return function(){return t.editor.trigger("valuechanged"),t.editor.util.reflow(e),e.click(),t.popover.one("popovershow",function(){return t.popover.srcEl.focus(),t.popover.srcEl[0].select()})}}(this))},n}(r),s=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return l(n,e),n.prototype.offset={top:6,left:-4},n.prototype.render=function(){var e;return e='<div class="link-settings">\n  <div class="settings-field">\n    <label>'+this._t("imageUrl")+'</label>\n    <input class="image-src" type="text" tabindex="1" />\n    <a class="btn-upload" href="javascript:;"\n      title="'+this._t("uploadImage")+'" tabindex="-1">\n      <span class="qing-editor-icon qing-editor-icon-upload"></span>\n    </a>\n  </div>\n  <div class=\'settings-field\'>\n    <label>'+this._t("imageAlt")+'</label>\n    <input class="image-alt" id="image-alt" type="text" tabindex="1" />\n  </div>\n  <div class="settings-field">\n    <label>'+this._t("imageSize")+'</label>\n    <input class="image-size" id="image-width" type="text" tabindex="2" />\n    <span class="times">×</span>\n    <input class="image-size" id="image-height" type="text" tabindex="3" />\n    <a class="btn-restore" href="javascript:;"\n      title="'+this._t("restoreImageSize")+'" tabindex="-1">\n      <span class="qing-editor-icon qing-editor-icon-undo"></span>\n    </a>\n  </div>\n</div>',this.el.addClass("image-popover").append(e),this.srcEl=this.el.find(".image-src"),this.widthEl=this.el.find("#image-width"),this.heightEl=this.el.find("#image-height"),this.altEl=this.el.find("#image-alt"),this.srcEl.on("keydown",function(t){return function(e){var n;if(13===e.which&&!t.target.hasClass("uploading"))return e.preventDefault(),n=document.createRange(),t.button.editor.selection.setRangeAfter(t.target,n),t.hide()}}(this)),this.srcEl.on("blur",function(t){return function(e){return t._loadImage(t.srcEl.val())}}(this)),this.el.find(".image-size").on("blur",function(e){return function(n){return e._resizeImg(t(n.currentTarget)),e.el.data("popover").refresh()}}(this)),this.el.find(".image-size").on("keyup",function(e){return function(n){var o;if(o=t(n.currentTarget),13!==n.which&&27!==n.which&&9!==n.which)return e._resizeImg(o,!0)}}(this)),this.el.find(".image-size").on("keydown",function(e){return function(n){var o,r,i;return r=t(n.currentTarget),13===n.which||27===n.which?(n.preventDefault(),13===n.which?e._resizeImg(r):e._restoreImg(),o=e.target,e.hide(),i=document.createRange(),e.button.editor.selection.setRangeAfter(o,i)):9===n.which?e.el.data("popover").refresh():void 0}}(this)),this.altEl.on("keydown",function(t){return function(e){var n;if(13===e.which)return e.preventDefault(),n=document.createRange(),t.button.editor.selection.setRangeAfter(t.target,n),t.hide()}}(this)),this.altEl.on("keyup",function(t){return function(e){if(13!==e.which&&27!==e.which&&9!==e.which)return t.alt=t.altEl.val(),t.target.attr("alt",t.alt)}}(this)),this.el.find(".btn-restore").on("click",function(t){return function(e){return t._restoreImg(),t.el.data("popover").refresh()}}(this)),this.editor.on("valuechanged",function(t){return function(e){if(t.active)return t.refresh()}}(this)),this._initUploader()},n.prototype._initUploader=function(){var e,n;return e=this.el.find(".btn-upload"),null==this.editor.uploader?void e.remove():(n=function(n){return function(){return n.input&&n.input.remove(),n.input=t("<input/>",{type:"file",title:n._t("uploadImage"),multiple:!0,accept:"image/*"}).appendTo(e)}}(this),n(),this.el.on("click mousedown","input[type=file]",function(t){return t.stopPropagation()}),this.el.on("change","input[type=file]",function(t){return function(e){return t.editor.uploader.upload(t.input,{inline:!0,img:t.target}),n()}}(this)))},n.prototype._resizeImg=function(e,n){var o,r,i;if(null==n&&(n=!1),r=1*e.val(),this.target&&(t.isNumeric(r)||r<0))return e.is(this.widthEl)?(i=r,o=this.height*r/this.width,this.heightEl.val(o)):(o=r,i=this.width*r/this.height,this.widthEl.val(i)),n?void 0:(this.target.attr({width:i,height:o}),this.editor.trigger("valuechanged"))},n.prototype._restoreImg=function(){var t,e;return e=(null!=(t=this.target.data("image-size"))?t.split(","):void 0)||[this.width,this.height],this.target.attr({width:1*e[0],height:1*e[1]}),this.widthEl.val(e[0]),this.heightEl.val(e[1]),this.editor.trigger("valuechanged")},n.prototype._loadImage=function(t,e){if(/^data:image/.test(t)&&!this.editor.uploader)return void(e&&e(!1));if(this.target.attr("src")!==t)return this.button.loadImage(this.target,t,function(n){return function(o){var r;if(o)return n.active&&(n.width=o.width,n.height=o.height,n.widthEl.val(n.width),n.heightEl.val(n.height)),/^data:image/.test(t)?(r=n.editor.util.dataURLtoBlob(t),r.name="Base64 Image.png",n.editor.uploader.upload(r,{inline:!0,img:n.target})):n.editor.trigger("valuechanged"),e?e(o):void 0}}(this))},n.prototype.show=function(){var t,e;return e=1<=arguments.length?p.call(arguments,0):[],n.__super__.show.apply(this,e),t=this.target,this.width=t.width(),this.height=t.height(),this.alt=t.attr("alt"),t.hasClass("uploading")?this.srcEl.val(this._t("uploading")).prop("disabled",!0):(this.srcEl.val(t.attr("src")).prop("disabled",!1),this.widthEl.val(this.width),this.heightEl.val(this.height),this.altEl.val(this.alt))},n}(a),n.exports=i},{"./button.coffee":4,"./popover.coffee":16}],10:[function(t,e,n){var o,r,i=function(t,e){function n(){this.constructor=t}for(var o in e)s.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},s={}.hasOwnProperty;o=t("./button.coffee"),r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.name="indent",e.prototype.icon="indent",e.prototype._init=function(){return this.title=this._t(this.name)+" (Tab)",e.__super__._init.apply(this,arguments)},e.prototype._status=function(){},
e.prototype.command=function(){return this.editor.indentation.indent()},e}(o),e.exports=r},{"./button.coffee":4}],11:[function(e,n,o){var r,i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;r=e("./button.coffee"),i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.prototype.name="italic",n.prototype.icon="italic",n.prototype.htmlTag="i",n.prototype.disableTag="pre",n.prototype.shortcut="cmd+i",n.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + i )":(this.title=this.title+" ( Ctrl + i )",this.shortcut="ctrl+i"),n.__super__._init.apply(this,arguments)},n.prototype._activeStatus=function(){var t;return t=document.queryCommandState("italic")===!0,this.setActive(t),this.active},n.prototype.command=function(){return document.execCommand("italic"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),t(document).trigger("selectionchange")},n}(r),n.exports=i},{"./button.coffee":4}],12:[function(e,n,o){var r,i,s,a,l=function(t,e){function n(){this.constructor=t}for(var o in e)u.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty,p=[].slice;r=e("./button.coffee"),a=e("./popover.coffee"),i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return l(n,e),n.prototype.name="link",n.prototype.icon="link",n.prototype.htmlTag="a",n.prototype.disableTag="pre",n.prototype.render=function(){var t;return t=1<=arguments.length?p.call(arguments,0):[],n.__super__.render.apply(this,t),this.popover=new s({button:this})},n.prototype._status=function(){return n.__super__._status.call(this),this.active&&!this.editor.selection.rangeAtEndOf(this.node)?this.popover.show(this.node):this.popover.hide()},n.prototype.command=function(){var e,n,o,r,i,s;return i=this.editor.selection.range(),this.active?(s=document.createTextNode(this.node.text()),this.node.replaceWith(s),i.selectNode(s)):(e=t(i.extractContents()),r=this.editor.formatter.clearHtml(e.contents(),!1),n=t("<a/>",{href:"http://www.example.com",target:"_blank",text:r||this._t("linkText")}),this.editor.selection.blockNodes().length>0?i.insertNode(n[0]):(o=t("<p/>").append(n),i.insertNode(o[0])),i.selectNodeContents(n[0]),this.popover.one("popovershow",function(t){return function(){return r?(t.popover.urlEl.focus(),t.popover.urlEl[0].select()):(t.popover.textEl.focus(),t.popover.textEl[0].select())}}(this))),this.editor.selection.range(i),this.editor.trigger("valuechanged")},n}(r),s=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return l(n,e),n.prototype.render=function(){var e;return e='<div class="link-settings">\n  <div class="settings-field">\n    <label>'+this._t("linkText")+'</label>\n    <input class="link-text" type="text"/>\n    <a class="btn-unlink" href="javascript:;" title="'+this._t("removeLink")+'"\n      tabindex="-1">\n      <span class="qing-editor-icon qing-editor-icon-unlink"></span>\n    </a>\n  </div>\n  <div class="settings-field">\n    <label>'+this._t("linkUrl")+'</label>\n    <input class="link-url" type="text"/>\n  </div>\n  <div class="settings-field">\n    <label>'+this._t("linkTarget")+'</label>\n    <select class="link-target">\n      <option value="_blank">'+this._t("openLinkInNewWindow")+' (_blank)</option>\n      <option value="_self">'+this._t("openLinkInCurrentWindow")+" (_self)</option>\n    </select>\n  </div>\n</div>",this.el.addClass("link-popover").append(e),this.textEl=this.el.find(".link-text"),this.urlEl=this.el.find(".link-url"),this.unlinkEl=this.el.find(".btn-unlink"),this.selectTarget=this.el.find(".link-target"),this.textEl.on("keyup",function(t){return function(e){if(13!==e.which)return t.target.text(t.textEl.val()),t.editor.inputManager.throttledValueChanged()}}(this)),this.urlEl.on("keyup",function(t){return function(e){var n;if(13!==e.which)return n=t.urlEl.val(),!/https?:\/\/|^\//gi.test(n)&&n&&(n="http://"+n),t.target.attr("href",n),t.editor.inputManager.throttledValueChanged()}}(this)),t([this.urlEl[0],this.textEl[0]]).on("keydown",function(e){return function(n){var o;if(13===n.which||27===n.which||!n.shiftKey&&9===n.which&&t(n.target).hasClass("link-url"))return n.preventDefault(),o=document.createRange(),e.editor.selection.setRangeAfter(e.target,o),e.hide(),e.editor.inputManager.throttledValueChanged()}}(this)),this.unlinkEl.on("click",function(t){return function(e){var n,o;return o=document.createTextNode(t.target.text()),t.target.replaceWith(o),t.hide(),n=document.createRange(),t.editor.selection.setRangeAfter(o,n),t.editor.inputManager.throttledValueChanged()}}(this)),this.selectTarget.on("change",function(t){return function(e){return t.target.attr("target",t.selectTarget.val()),t.editor.inputManager.throttledValueChanged()}}(this))},n.prototype.show=function(){var t;return t=1<=arguments.length?p.call(arguments,0):[],n.__super__.show.apply(this,t),this.textEl.val(this.target.text()),this.urlEl.val(this.target.attr("href"))},n}(a),n.exports=i},{"./button.coffee":4,"./popover.coffee":16}],13:[function(e,n,o){var r,i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;r=e("./button.coffee"),i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.prototype.type="",n.prototype.disableTag="pre, table",n.prototype.command=function(e){var n,o,r;return o=this.editor.selection.blockNodes(),r="ul"===this.type?"ol":"ul",this.editor.selection.save(),n=null,o.each(function(e){return function(o,i){var s;if(s=t(i),!(s.is("blockquote, li")||s.is(e.disableTag)||e.editor.util.isDecoratedNode(s))&&t.contains(document,i))return s.is(e.type)?(s.children("li").each(function(n,o){var r,i;return i=t(o),r=i.children("ul, ol").insertAfter(s),t("<p/>").append(t(o).html()||e.editor.util.phBr).insertBefore(s)}),s.remove()):s.is(r)?t("<"+e.type+"/>").append(s.contents()).replaceAll(s):n&&s.prev().is(n)?(t("<li/>").append(s.html()||e.editor.util.phBr).appendTo(n),s.remove()):(n=t("<"+e.type+"><li></li></"+e.type+">"),n.find("li").append(s.html()||e.editor.util.phBr),n.replaceAll(s))}}(this)),this.editor.selection.restore(),this.editor.trigger("valuechanged")},n}(r),n.exports=i},{"./button.coffee":4}],14:[function(t,e,n){var o,r,i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;o=t("./button.coffee"),r=t("./list.coffee"),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.type="ol",e.prototype.name="ol",e.prototype.icon="list-ol",e.prototype.htmlTag="ol",e.prototype.shortcut="cmd+/",e.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + / )":(this.title=this.title+" ( ctrl + / )",this.shortcut="ctrl+/"),e.__super__._init.apply(this,arguments)},e}(r),e.exports=i},{"./button.coffee":4,"./list.coffee":13}],15:[function(t,e,n){var o,r,i=function(t,e){function n(){this.constructor=t}for(var o in e)s.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},s={}.hasOwnProperty;o=t("./button.coffee"),r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e.prototype.name="outdent",e.prototype.icon="outdent",e.prototype._init=function(){return this.title=this._t(this.name)+" (Shift + Tab)",e.__super__._init.apply(this,arguments)},e.prototype._status=function(){},e.prototype.command=function(){return this.editor.indentation.indent(!0)},e}(o),e.exports=r},{"./button.coffee":4}],16:[function(n,o,r){var i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.opts={editor:null,button:null},n.prototype.offset={top:4,left:0},n.prototype.target=null,n.prototype.active=!1,n.prototype._setOptions=function(e){return n.__super__._setOptions.apply(this,arguments),t.extend(this.opts,n.opts,e)},n.prototype._init=function(){return this.button=this.opts.button,this.editor=this.opts.button.editor,this.el=t('<div class="qing-editor-popover"></div>').appendTo(this.editor.el).data("popover",this),this.render(),this.el.on("mouseenter",function(t){return function(e){return t.el.addClass("hover")}}(this)),this.el.on("mouseleave",function(t){return function(e){return t.el.removeClass("hover")}}(this))},n.prototype.render=function(){},n.prototype._initLabelWidth=function(){var e;if(e=this.el.find(".settings-field"),e.length>0)return this._labelWidth=0,e.each(function(e){return function(n,o){var r,i;if(r=t(o),i=r.find("label"),i.length>0)return e._labelWidth=Math.max(e._labelWidth,i.width())}}(this)),e.find("label").width(this._labelWidth)},n.prototype.show=function(e,n){if(null==n&&(n="bottom"),null!=e)return this.el.siblings(".qing-editor-popover").each(function(e,n){if(n=t(n).data("popover"),n.active)return n.hide()}),this.active&&this.target&&this.target.removeClass("selected"),this.target=e.addClass("selected"),this.active?(this.refresh(n),this.trigger("popovershow")):(this.active=!0,this.el.css({left:-9999}).show(),this._labelWidth||this._initLabelWidth(),this.editor.util.reflow(),this.refresh(n),this.trigger("popovershow"))},n.prototype.hide=function(){if(this.active)return this.target&&this.target.removeClass("selected"),this.target=null,this.active=!1,this.el.hide(),this.trigger("popoverhide")},n.prototype.refresh=function(t){var e,n,o,r,i,s;if(null==t&&(t="bottom"),this.active)return e=this.editor.el.offset(),i=this.target.offset(),r=this.target.outerHeight(),"bottom"===t?s=i.top-e.top+r:"top"===t&&(s=i.top-e.top-this.el.height()),o=this.editor.wrapper.width()-this.el.outerWidth()-10,n=Math.min(i.left-e.left,o),this.el.css({top:s+this.offset.top,left:n+this.offset.left})},n.prototype.destroy=function(){return this.target=null,this.active=!1,this.editor.off(".linkpopover"),this.el.remove()},n.prototype._t=function(t){return this.button._t(t)},n}(e),o.exports=i},{}],17:[function(e,n,o){var r,i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;r=e("./button.coffee"),i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.prototype.name="strikethrough",n.prototype.icon="strikethrough",n.prototype.htmlTag="strike",n.prototype.disableTag="pre",n.prototype._activeStatus=function(){var t;return t=document.queryCommandState("strikethrough")===!0,this.setActive(t),this.active},n.prototype.command=function(){return document.execCommand("strikethrough"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),t(document).trigger("selectionchange")},n}(r),n.exports=i},{"./button.coffee":4}],18:[function(e,n,o){var r,i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;r=e("./button.coffee"),i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.prototype.name="table",n.prototype.icon="table",n.prototype.htmlTag="table",n.prototype.disableTag="pre, li, blockquote",n.prototype.menu=!0,n.prototype._init=function(){return n.__super__._init.apply(this,arguments),t.merge(this.editor.formatter._allowedTags,["thead","th","tbody","tr","td","colgroup","col"]),t.extend(this.editor.formatter._allowedAttributes,{td:["rowspan","colspan"],col:["width"]}),t.extend(this.editor.formatter._allowedStyles,{td:["text-align"],th:["text-align"]}),this._initShortcuts(),this.editor.on("decorate",function(e){return function(n,o){return o.find("table").each(function(n,o){return e.decorate(t(o))})}}(this)),this.editor.on("undecorate",function(e){return function(n,o){return o.find("table").each(function(n,o){return e.undecorate(t(o))})}}(this)),this.editor.on("selectionchanged.table",function(t){return function(e){var n,o;if(t.editor.body.find(".qing-editor-table td, .qing-editor-table th").removeClass("active"),o=t.editor.selection.range())return n=t.editor.selection.containerNode(),o.collapsed&&n.is(".qing-editor-table")&&(n=t.editor.selection.rangeAtStartOf(n)?n.find("th:first"):n.find("td:last"),t.editor.selection.setRangeAtEndOf(n)),n.closest("td, th",t.editor.body).addClass("active")}}(this)),this.editor.on("blur.table",function(t){return function(e){return t.editor.body.find(".qing-editor-table td, .qing-editor-table th").removeClass("active")}}(this)),this.editor.keystroke.add("up","td",function(t){return function(e,n){return t._tdNav(n,"up"),!0}}(this)),this.editor.keystroke.add("up","th",function(t){return function(e,n){return t._tdNav(n,"up"),!0}}(this)),this.editor.keystroke.add("down","td",function(t){return function(e,n){return t._tdNav(n,"down"),!0}}(this)),this.editor.keystroke.add("down","th",function(t){return function(e,n){return t._tdNav(n,"down"),!0}}(this))},n.prototype._tdNav=function(t,e){var n,o,r,i,s,a,l;return null==e&&(e="up"),r="up"===e?"prev":"next",l="up"===e?["tbody","thead"]:["thead","tbody"],a=l[0],i=l[1],o=t.parent("tr"),n=this["_"+r+"Row"](o),!(n.length>0)||(s=o.find("td, th").index(t),this.editor.selection.setRangeAtEndOf(n.find("td, th").eq(s)))},n.prototype._nextRow=function(t){var e;return e=t.next("tr"),e.length<1&&t.parent("thead").length>0&&(e=t.parent("thead").next("tbody").find("tr:first")),e},n.prototype._prevRow=function(t){var e;return e=t.prev("tr"),e.length<1&&t.parent("tbody").length>0&&(e=t.parent("tbody").prev("thead").find("tr")),e},n.prototype.initResize=function(e){var n,o,r;return r=e.parent(".qing-editor-table"),n=e.find("colgroup"),n.length<1&&(n=t("<colgroup/>").prependTo(e),e.find("thead tr th").each(function(e,o){var r;return r=t("<col/>").appendTo(n)}),this.refreshTableWidth(e)),o=t("<div />",{class:"qing-editor-resize-handle",contenteditable:"false"}).appendTo(r),r.on("mousemove","td, th",function(e){var i,s,a,l,u,p;if(!r.hasClass("resizing"))return s=t(e.currentTarget),p=e.pageX-t(e.currentTarget).offset().left,p<5&&s.prev().length>0&&(s=s.prev()),s.next("td, th").length<1?void o.hide():(null!=(l=o.data("td"))?l.is(s):void 0)?void o.show():(a=s.parent().find("td, th").index(s),i=n.find("col").eq(a),(null!=(u=o.data("col"))?u.is(i):void 0)?void o.show():o.css("left",s.position().left+s.outerWidth()-5).data("td",s).data("col",i).show())}),r.on("mouseleave",function(t){return o.hide()}),r.on("mousedown",".qing-editor-resize-handle",function(e){var n,o,i,s,a,l,u,p,d,c,h;return n=t(e.currentTarget),i=n.data("td"),o=n.data("col"),a=i.next("td, th"),s=o.next("col"),c=e.pageX,p=1*i.outerWidth(),d=1*a.outerWidth(),u=parseFloat(n.css("left")),h=i.closest("table").width(),l=50,t(document).on("mousemove.qing-editor-resize-table",function(t){var e,r,i;return e=t.pageX-c,r=p+e,i=d-e,r<l?(r=l,e=l-p,i=d-e):i<l&&(i=l,e=d-l,r=p+e),o.attr("width",r/h*100+"%"),s.attr("width",i/h*100+"%"),n.css("left",u+e)}),t(document).one("mouseup.qing-editor-resize-table",function(e){return t(document).off(".qing-editor-resize-table"),r.removeClass("resizing")}),r.addClass("resizing"),!1})},n.prototype._initShortcuts=function(){return this.editor.hotkeys.add("ctrl+alt+up",function(t){return function(e){return t.editMenu.find(".menu-item[data-param=insertRowAbove]").click(),!1}}(this)),this.editor.hotkeys.add("ctrl+alt+down",function(t){return function(e){return t.editMenu.find(".menu-item[data-param=insertRowBelow]").click(),!1}}(this)),this.editor.hotkeys.add("ctrl+alt+left",function(t){return function(e){return t.editMenu.find(".menu-item[data-param=insertColLeft]").click(),!1}}(this)),this.editor.hotkeys.add("ctrl+alt+right",function(t){return function(e){return t.editMenu.find(".menu-item[data-param=insertColRight]").click(),!1}}(this))},n.prototype.decorate=function(e){var n,o,r;return e.parent(".qing-editor-table").length>0&&this.undecorate(e),e.wrap('<div class="qing-editor-table"></div>'),e.find("thead").length<1&&(r=t("<thead />"),n=e.find("tr").first(),r.append(n),this._changeCellTag(n,"th"),o=e.find("tbody"),o.length>0?o.before(r):e.prepend(r)),this.initResize(e),e.parent()},n.prototype.undecorate=function(t){if(t.parent(".qing-editor-table").length>0)return t.parent().replaceWith(t)},n.prototype.renderMenu=function(){var e;return t('<div class="menu-create-table">\n</div>\n<div class="menu-edit-table">\n  <ul>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteRow">\n        <span>'+this._t("deleteRow")+'</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertRowAbove">\n        <span>'+this._t("insertRowAbove")+' ( Ctrl + Alt + ↑ )</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertRowBelow">\n        <span>'+this._t("insertRowBelow")+' ( Ctrl + Alt + ↓ )</span>\n      </a>\n    </li>\n    <li><span class="separator"></span></li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteCol">\n        <span>'+this._t("deleteColumn")+'</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertColLeft">\n        <span>'+this._t("insertColumnLeft")+' ( Ctrl + Alt + ← )</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertColRight">\n        <span>'+this._t("insertColumnRight")+' ( Ctrl + Alt + → )</span>\n      </a>\n    </li>\n    <li><span class="separator"></span></li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteTable">\n        <span>'+this._t("deleteTable")+"</span>\n      </a>\n    </li>\n  </ul>\n</div>").appendTo(this.menuWrapper),this.createMenu=this.menuWrapper.find(".menu-create-table"),this.editMenu=this.menuWrapper.find(".menu-edit-table"),e=this.createTable(6,6).appendTo(this.createMenu),this.createMenu.on("mouseenter","td, th",function(n){return function(o){var r,i,s,a;return n.createMenu.find("td, th").removeClass("selected"),r=t(o.currentTarget),i=r.parent(),a=i.find("td, th").index(r)+1,s=i.prevAll("tr").addBack(),i.parent().is("tbody")&&(s=s.add(e.find("thead tr"))),s.find("td:lt("+a+"), th:lt("+a+")").addClass("selected")}}(this)),this.createMenu.on("mouseleave",function(e){return t(e.currentTarget).find("td, th").removeClass("selected")}),this.createMenu.on("mousedown","td, th",function(n){return function(o){var r,i,s,a,l;if(n.wrapper.removeClass("menu-on"),n.editor.inputManager.focused)return i=t(o.currentTarget),s=i.parent(),a=s.find("td").index(i)+1,l=s.prevAll("tr").length+1,s.parent().is("tbody")&&(l+=1),e=n.createTable(l,a,!0),r=n.editor.selection.blockNodes().last(),n.editor.util.isEmptyNode(r)?r.replaceWith(e):r.after(e),n.decorate(e),n.editor.selection.setRangeAtStartOf(e.find("th:first")),n.editor.trigger("valuechanged"),!1}}(this))},n.prototype.createTable=function(e,n,o){var r,i,s,a,l,u,p,d,c,h,f;for(r=t("<table/>"),a=t("<thead/>").appendTo(r),i=t("<tbody/>").appendTo(r),c=p=0,h=e;0<=h?p<h:p>h;c=0<=h?++p:--p)for(l=t("<tr/>"),l.appendTo(0===c?a:i),u=d=0,f=n;0<=f?d<f:d>f;u=0<=f?++d:--d)s=t(0===c?"<th/>":"<td/>").appendTo(l),o&&s.append(this.editor.util.phBr);return r},n.prototype.refreshTableWidth=function(e){var n,o;return o=e.width(),n=e.find("col"),e.find("thead tr th").each(function(e,r){var i;return i=n.eq(e),i.attr("width",t(r).outerWidth()/o*100+"%")})},n.prototype.setActive=function(t){return n.__super__.setActive.call(this,t),t?(this.createMenu.hide(),this.editMenu.show()):(this.createMenu.show(),this.editMenu.hide())},n.prototype._changeCellTag=function(e,n){return e.find("td, th").each(function(e,o){var r;return r=t(o),r.replaceWith("<"+n+">"+r.html()+"</"+n+">")})},n.prototype.deleteRow=function(t){var e,n,o;return n=t.parent("tr"),n.closest("table").find("tr").length<1?this.deleteTable(t):(e=this._nextRow(n),e.length>0||(e=this._prevRow(n)),o=n.find("td, th").index(t),n.parent().is("thead")&&(e.appendTo(n.parent()),this._changeCellTag(e,"th")),n.remove(),this.editor.selection.setRangeAtEndOf(e.find("td, th").eq(o)))},n.prototype.insertRow=function(e,n){var o,r,i,s,a,l,u,p,d;for(null==n&&(n="after"),i=e.parent("tr"),r=i.closest("table"),a=0,r.find("tr").each(function(e,n){return a=Math.max(a,t(n).find("td").length)}),u=i.find("td, th").index(e),o=t("<tr/>"),s="td","after"===n&&i.parent().is("thead")?i.parent().next("tbody").prepend(o):"before"===n&&i.parent().is("thead")?(i.before(o),i.parent().next("tbody").prepend(i),this._changeCellTag(i,"td"),s="th"):i[n](o),l=p=1,d=a;1<=d?p<=d:p>=d;l=1<=d?++p:--p)t("<"+s+"/>").append(this.editor.util.phBr).appendTo(o);return this.editor.selection.setRangeAtStartOf(o.find("td, th").eq(u))},n.prototype.deleteCol=function(e){var n,o,r,i,s,a;return r=e.parent("tr"),a=r.closest("table").find("tr").length<2,s=e.siblings("td, th").length<1,a&&s?this.deleteTable(e):(i=r.find("td, th").index(e),n=e.next("td, th"),n.length>0||(n=r.prev("td, th")),o=r.closest("table"),o.find("col").eq(i).remove(),o.find("tr").each(function(e,n){return t(n).find("td, th").eq(i).remove()}),this.refreshTableWidth(o),this.editor.selection.setRangeAtEndOf(n))},n.prototype.insertCol=function(e,n){var o,r,i,s,a,l,u,p;return null==n&&(n="after"),a=e.parent("tr"),l=a.find("td, th").index(e),s=e.closest("table"),o=s.find("col").eq(l),s.find("tr").each(function(e){return function(o,r){var i,s;return s=t(r).parent().is("thead")?"th":"td",i=t("<"+s+"/>").append(e.editor.util.phBr),t(r).find("td, th").eq(l)[n](i)}}(this)),r=t("<col/>"),o[n](r),u=s.width(),p=Math.max(parseFloat(o.attr("width"))/2,50/u*100),o.attr("width",p+"%"),r.attr("width",p+"%"),this.refreshTableWidth(s),i="after"===n?e.next("td, th"):e.prev("td, th"),this.editor.selection.setRangeAtStartOf(i)},n.prototype.deleteTable=function(t){var e,n;if(n=t.closest(".qing-editor-table"),e=n.next("p"),n.remove(),e.length>0)return this.editor.selection.setRangeAtStartOf(e)},n.prototype.command=function(t){var e;if(e=this.editor.selection.containerNode().closest("td, th"),e.length>0){if("deleteRow"===t)this.deleteRow(e);else if("insertRowAbove"===t)this.insertRow(e,"before");else if("insertRowBelow"===t)this.insertRow(e);else if("deleteCol"===t)this.deleteCol(e);else if("insertColLeft"===t)this.insertCol(e,"before");else if("insertColRight"===t)this.insertCol(e);else{if("deleteTable"!==t)return;this.deleteTable(e)}return this.editor.trigger("valuechanged")}},n}(r),n.exports=i},{"./button.coffee":4}],19:[function(e,n,o){var r,i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;r=e("./button.coffee"),i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.prototype.name="title",n.prototype.htmlTag="h1, h2, h3, h4, h5",n.prototype.disableTag="pre, table",n.prototype._init=function(){return this.menu=[{name:"normal",text:this._t("normalText"),param:"p"},"|",{name:"h1",text:this._t("title")+" 1",param:"h1"},{name:"h2",text:this._t("title")+" 2",param:"h2"},{name:"h3",text:this._t("title")+" 3",param:"h3"},{name:"h4",text:this._t("title")+" 4",param:"h4"},{name:"h5",text:this._t("title")+" 5",param:"h5"}],n.__super__._init.apply(this,arguments)},n.prototype.setActive=function(t,e){if(n.__super__.setActive.call(this,t),t&&(e||(e=this.node[0].tagName.toLowerCase())),this.el.removeClass("active-p active-h1 active-h2 active-h3 active-h4 active-h5"),t)return this.el.addClass("active active-"+e)},n.prototype.command=function(e){var n;return n=this.editor.selection.rootNodes(),this.editor.selection.save(),n.each(function(n){return function(o,r){var i;if(i=t(r),!(i.is("blockquote")||i.is(e)||i.is(n.disableTag)||n.editor.util.isDecoratedNode(i)))return t("<"+e+"/>").append(i.contents()).replaceAll(i)}}(this)),this.editor.selection.restore(),this.editor.trigger("valuechanged")},n}(r),n.exports=i},{"./button.coffee":4}],20:[function(e,n,o){var r,i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;r=e("./button.coffee"),i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.prototype.name="underline",n.prototype.icon="underline",n.prototype.htmlTag="u",n.prototype.disableTag="pre",n.prototype.shortcut="cmd+u",n.prototype.render=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + u )":(this.title=this.title+" ( Ctrl + u )",this.shortcut="ctrl+u"),n.__super__.render.apply(this,arguments)},n.prototype._activeStatus=function(){var t;return t=document.queryCommandState("underline")===!0,this.setActive(t),this.active},n.prototype.command=function(){return document.execCommand("underline"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),t(document).trigger("selectionchange")},n}(r),n.exports=i},{"./button.coffee":4}],21:[function(t,e,n){var o,r,i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;o=t("./button.coffee"),r=t("./list.coffee"),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return s(e,t),e.prototype.type="ul",e.prototype.name="ul",e.prototype.icon="list-ul",e.prototype.htmlTag="ul",e.prototype.shortcut="cmd+.",e.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + . )":(this.title=this.title+" ( Ctrl + . )",this.shortcut="ctrl+."),e.__super__._init.apply(this,arguments)},e}(r),e.exports=i},{"./button.coffee":4,"./list.coffee":13}],22:[function(n,o,r){var i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.opts={editor:null,pasteImage:!1,cleanPaste:!1},n.prototype._setOptions=function(e){return n.__super__._setOptions.apply(this,arguments),t.extend(this.opts,n.opts,e)},n.prototype._init=function(){return this.editor=this.opts.editor,this.opts.pasteImage&&"string"!=typeof this.opts.pasteImage&&(this.opts.pasteImage="inline"),this.editor.body.on("paste",function(t){return function(e){var n;if(!t.pasting&&!t._pasteBin)return t.editor.trigger(e)!==!1&&(n=t.editor.selection.deleteRangeContents(),t.editor.body.html()?n.collapsed||n.collapse(!0):(t.editor.formatter.format(),t.editor.selection.setRangeAtStartOf(t.editor.body.find("p:first"))),!t._processPasteByClipboardApi(e)&&(t.editor.inputManager.throttledValueChanged.clear(),t.editor.inputManager.throttledSelectionChanged.clear(),t.editor.undoManager.throttledPushState.clear(),t.editor.selection.reset(),t.editor.undoManager.resetCaretPosition(),t.pasting=!0,t._getPasteContent(function(e){return t._processPasteContent(e),t._pasteInBlockEl=null,t._pastePlainText=null,t.pasting=!1})))}}(this))},n.prototype._processPasteByClipboardApi=function(t){var e,n,o,r;if(!this.editor.util.browser.edge&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items&&t.originalEvent.clipboardData.items.length>0&&(n=t.originalEvent.clipboardData.items[0],/^image\//.test(n.type))){if(e=n.getAsFile(),null==e||!this.opts.pasteImage)return;if(e.name||(e.name="Clipboard Image.png"),this.editor.trigger("pasting",[e])===!1)return;return r={},r[this.opts.pasteImage]=!0,null!=(o=this.editor.uploader)&&o.upload(e,r),!0}},n.prototype._getPasteContent=function(e){var n;return this._pasteBin=t('<div contenteditable="true" />').addClass("qing-editor-paste-bin").attr("tabIndex","-1").appendTo(this.editor.el),n={html:this.editor.body.html(),caret:this.editor.undoManager.caretPosition()},this._pasteBin.focus(),setTimeout(function(o){return function(){var r;return o.editor.hidePopover(),o.editor.body.get(0).innerHTML=n.html,o.editor.undoManager.caretPosition(n.caret),o.editor.body.focus(),o.editor.selection.reset(),o.editor.selection.range(),o._pasteInBlockEl=o.editor.selection.blockNodes().last(),o._pastePlainText=o.opts.cleanPaste||o._pasteInBlockEl.is("pre, table"),o._pastePlainText?r=o.editor.formatter.clearHtml(o._pasteBin.html(),!0):(r=t("<div/>").append(o._pasteBin.contents()),r.find("table colgroup").remove(),o.editor.formatter.format(r),o.editor.formatter.decorate(r),o.editor.formatter.beautify(r.children()),r=r.contents()),o._pasteBin.remove(),o._pasteBin=null,e(r)}}(this),0)},n.prototype._processPasteContent=function(e){var n,o,r,i,s,a,l,u,p,d,c,h,f,g,m,y,_,v,b,w,x,k,C;if(this.editor.trigger("pasting",[e])!==!1&&(n=this._pasteInBlockEl,e)){if(this._pastePlainText)if(n.is("table")){for(_=e.split("\n"),d=_.pop(),s=0,c=_.length;s<c;s++)y=_[s],this.editor.selection.insertNode(document.createTextNode(y)),this.editor.selection.insertNode(t("<br/>"));this.editor.selection.insertNode(document.createTextNode(d))}else for(e=t("<div/>").text(e),w=e.contents(),l=0,h=w.length;l<h;l++)b=w[l],this.editor.selection.insertNode(t(b)[0]);else if(n.is(this.editor.body))for(u=0,f=e.length;u<f;u++)b=e[u],this.editor.selection.insertNode(b);else{if(e.length<1)return;if(1===e.length)if(e.is("p")){if(i=e.contents(),1===i.length&&i.is("img")){if(o=i,/^data:image/.test(o.attr("src"))){if(!this.opts.pasteImage)return;return r=this.editor.util.dataURLtoBlob(o.attr("src")),r.name="Clipboard Image.png",C={},C[this.opts.pasteImage]=!0,void(null!=(x=this.editor.uploader)&&x.upload(r,C))}if(o.is('img[src^="webkit-fake-url://"]'))return}for(p=0,g=i.length;p<g;p++)b=i[p],this.editor.selection.insertNode(b)}else if(n.is("p")&&this.editor.util.isEmptyNode(n))n.replaceWith(e),this.editor.selection.setRangeAtEndOf(e);else if(e.is("ul, ol"))if(1===e.find("li").length)for(e=t("<div/>").text(e.text()),k=e.contents(),v=0,m=k.length;v<m;v++)b=k[v],this.editor.selection.insertNode(t(b)[0]);else n.is("li")?(n.parent().after(e),this.editor.selection.setRangeAtEndOf(e)):(n.after(e),this.editor.selection.setRangeAtEndOf(e));else n.after(e),this.editor.selection.setRangeAtEndOf(e);else n.is("li")&&(n=n.parent()),this.editor.selection.rangeAtStartOf(n)?a="before":this.editor.selection.rangeAtEndOf(n)?a="after":(this.editor.selection.breakBlockEl(n),a="before"),n[a](e),this.editor.selection.setRangeAtEndOf(e.last())}return this.editor.inputManager.throttledValueChanged()}},n}(e),o.exports=i},{}],23:[function(n,o,r){var i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty,l=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.name="Formatter",n.opts={editor:null,allowedTags:[],allowedAttributes:{},allowedStyles:{}},n.prototype._setOptions=function(e){return n.__super__._setOptions.apply(this,arguments),t.extend(this.opts,n.opts,e)},n.prototype._init=function(){return this.editor=this.opts.editor,this._allowedTags=t.merge(["br","span","a","img","b","strong","i","strike","u","font","p","ul","ol","li","blockquote","pre","code","h1","h2","h3","h4","hr"],this.opts.allowedTags),
this._allowedAttributes=t.extend({img:["src","alt","width","height","data-non-image"],a:["href","target"],font:["color"],code:["class"]},this.opts.allowedAttributes),this._allowedStyles=t.extend({span:["color","font-size"],b:["color"],i:["color"],strong:["color"],strike:["color"],u:["color"],p:["margin-left","text-align"],h1:["margin-left","text-align"],h2:["margin-left","text-align"],h3:["margin-left","text-align"],h4:["margin-left","text-align"]},this.opts.allowedStyles),this.editor.body.on("click","a",function(t){return!1})},n.prototype.decorate=function(t){return null==t&&(t=this.editor.body),this.editor.trigger("decorate",[t]),t},n.prototype.undecorate=function(t){return null==t&&(t=this.editor.body.clone()),this.editor.trigger("undecorate",[t]),t},n.prototype.autolink=function(e){var n,o,r,i,s,a,l,u,p,d,c,h,f;for(null==e&&(e=this.editor.body),l=[],r=function(n){return n.contents().each(function(n,o){var i,s;if(i=t(o),!i.is("a")&&!i.closest("a, pre",e).length)return!i.is("iframe")&&i.contents().length?r(i):(s=i.text())&&/https?:\/\/|www\./gi.test(s)?l.push(i):void 0})},r(e),p=/(https?:\/\/|www\.)[\w\-\.\?&=\/#%:,@\!\+]+/gi,i=0,a=l.length;i<a;i++){for(o=l[i],h=o.text(),d=[],u=null,s=0;null!==(u=p.exec(h));)c=h.substring(s,u.index),d.push(document.createTextNode(c)),s=p.lastIndex,f=/^(http(s)?:\/\/|\/)/.test(u[0])?u[0]:"http://"+u[0],n=t('<a href="'+f+'" rel="nofollow"></a>').text(u[0]),d.push(n[0]);d.push(document.createTextNode(h.substring(s))),o.replaceWith(t(d))}return e},n.prototype.format=function(e){var n,o,r,i,s,a,l,u,p,d;if(null==e&&(e=this.editor.body),e.is(":empty"))return e.append("<p>"+this.editor.util.phBr+"</p>"),e;for(p=e.contents(),r=0,s=p.length;r<s;r++)l=p[r],this.cleanNode(l,!0);for(d=e.contents(),i=0,a=d.length;i<a;i++)u=d[i],n=t(u),n.is("br")?("undefined"!=typeof o&&null!==o&&(o=null),n.remove()):this.editor.util.isBlockNode(u)?n.is("li")?o&&o.is("ul, ol")?o.append(u):(o=t("<ul/>").insertBefore(u),o.append(u)):o=null:(o&&!o.is("ul, ol")||(o=t("<p/>").insertBefore(u)),o.append(u),this.editor.util.isEmptyNode(o)&&o.append(this.editor.util.phBr));return e},n.prototype.cleanNode=function(e,n){var o,r,i,s,a,u,p,d,c,h,f,g,m,y,_,v,b,w;if(i=t(e),i.length>0){if(3===i[0].nodeType)return b=i.text().replace(/(\r\n|\n|\r)/gm,""),void(b?(w=document.createTextNode(b),i.replaceWith(w)):i.remove());if(d=i.is("iframe")?null:i.contents(),c=this.editor.util.isDecoratedNode(i),i.is(this._allowedTags.join(","))||c){if(i.is("a")&&(r=i.find("img")).length>0&&(i.replaceWith(r),i=r,d=null),i.is("td")&&(o=i.find(this.editor.util.blockNodes.join(","))).length>0&&(o.each(function(e){return function(e,n){return t(n).contents().unwrap()}}(this)),d=i.contents()),i.is("img")&&i.hasClass("uploading")&&i.remove(),!c){for(u=this._allowedAttributes[i[0].tagName.toLowerCase()],_=t.makeArray(i[0].attributes),h=0,g=_.length;h<g;h++)p=_[h],"style"!==p.name&&(null!=u&&(v=p.name,l.call(u,v)>=0)||i.removeAttr(p.name));this._cleanNodeStyles(i),i.is("span")&&0===i[0].attributes.length&&i.contents().first().unwrap()}}else 1!==i[0].nodeType||i.is(":empty")?(i.remove(),d=null):i.is("div, article, dl, header, footer, tr")?(i.append("<br/>"),d.first().unwrap()):i.is("table")?(s=t("<p/>"),i.find("tr").each(function(e,n){return s.append(t(n).text()+"<br/>")}),i.replaceWith(s),d=null):i.is("thead, tfoot")?(i.remove(),d=null):i.is("th")?(a=t("<td/>").append(i.contents()),i.replaceWith(a)):d.first().unwrap();if(n&&null!=d&&!i.is("pre"))for(f=0,m=d.length;f<m;f++)y=d[f],this.cleanNode(y,!0);return null}},n.prototype._cleanNodeStyles=function(e){var n,o,r,i,s,a,u,p,d;if(p=e.attr("style")){if(e.removeAttr("style"),n=this._allowedStyles[e[0].tagName.toLowerCase()],!(n&&n.length>0))return e;for(d={},s=p.split(";"),o=0,r=s.length;o<r;o++)u=s[o],u=t.trim(u),i=u.split(":"),(i.length=2)&&(a=i[0],l.call(n,a)>=0&&(d[t.trim(i[0])]=t.trim(i[1])));return Object.keys(d).length>0&&e.css(d),e}},n.prototype.clearHtml=function(e,n){var o,r,i;return null==n&&(n=!0),o=t("<div/>").append(e),r=o.contents(),i="",r.each(function(e){return function(o,s){var a,l;return 3===s.nodeType?i+=s.nodeValue:1===s.nodeType&&(a=t(s),l=a.is("iframe")?null:a.contents(),l&&l.length>0&&(i+=e.clearHtml(l)),n&&o<r.length-1&&a.is("br, p, div, li,tr, pre, address, artticle, aside, dl, figcaption, footer, h1, h2,h3, h4, header"))?i+="\n":void 0}}(this)),i},n.prototype.beautify=function(e){var n;return n=function(t){return!!(t.is("p")&&!t.text()&&t.children(":not(br)").length<1)},e.each(function(e,o){var r,i;return r=t(o),i=r.is(':not(img, br, col, td, hr, [class^="qing-editor-"]):empty'),(i||n(r))&&r.remove(),r.find(':not(img, br, col, td, hr, [class^="qing-editor-"]):empty').remove()})},n}(e),o.exports=i},{}],24:[function(n,o,r){var i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.count=0,n.keyNameMap={8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",91:"Meta",93:"Meta",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"Multiply",107:"Add",109:"Subtract",110:"Decimal",111:"Divide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"F13",125:"F14",126:"F15",127:"F16",128:"F17",129:"F18",130:"F19",131:"F20",132:"F21",133:"F22",134:"F23",135:"F24",59:";",61:"=",186:";",187:"=",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},n.aliases={escape:"esc",delete:"del",return:"enter",ctrl:"control",space:"spacebar",ins:"insert",cmd:"meta",command:"meta",wins:"meta",windows:"meta"},n.normalize=function(t){var e,n,o,r,i,s;for(i=t.toLowerCase().replace(/\s+/gi,"").split("+"),e=n=0,s=i.length;n<s;e=++n)o=i[e],i[e]=this.aliases[o]||o;return r=i.pop(),i.sort().push(r),i.join("_")},n.opts={el:document},n.prototype._setOptions=function(e){return n.__super__._setOptions.apply(this,arguments),t.extend(this.opts,n.opts,e)},n.prototype._init=function(){return this.id=++this.constructor.count,this._map={},this._delegate="string"==typeof this.opts.el?document:this.opts.el,t(this._delegate).on("keydown.simple-hotkeys-"+this.id,this.opts.el,function(t){return function(e){var n;return null!=(n=t._getHander(e))?n.call(t,e):void 0}}(this))},n.prototype._getHander=function(t){var e,n;if(e=this.constructor.keyNameMap[t.which])return n="",t.altKey&&(n+="alt_"),t.ctrlKey&&(n+="control_"),t.metaKey&&(n+="meta_"),t.shiftKey&&(n+="shift_"),n+=e.toLowerCase(),this._map[n]},n.prototype.respondTo=function(t){return"string"==typeof t?null!=this._map[this.constructor.normalize(t)]:null!=this._getHander(t)},n.prototype.add=function(t,e){return this._map[this.constructor.normalize(t)]=e,this},n.prototype.remove=function(t){return delete this._map[this.constructor.normalize(t)],this},n.prototype.destroy=function(){return t(this._delegate).off(".simple-hotkeys-"+this.id),this._map={},this},n}(e),o.exports=i},{}],25:[function(t,e,n){e.exports={blockquote:"引用",bold:"加粗文字",code:"插入代码",color:"文字颜色",coloredText:"彩色文字",hr:"分隔线",image:"插入图片",externalImage:"外链图片",uploadImage:"上传图片",uploadFailed:"上传失败了",uploadError:"上传出错了",imageUrl:"图片地址",imageSize:"图片尺寸",imageAlt:"图片描述",restoreImageSize:"还原图片尺寸",uploading:"正在上传",indent:"向右缩进",outdent:"向左缩进",italic:"斜体文字",link:"插入链接",linkText:"链接文字",linkUrl:"链接地址",linkTarget:"打开方式",openLinkInCurrentWindow:"在当前窗口中打开",openLinkInNewWindow:"在新窗口中打开",removeLink:"移除链接",ol:"有序列表",ul:"无序列表",strikethrough:"删除线文字",table:"表格",deleteRow:"删除行",insertRowAbove:"在上面插入行",insertRowBelow:"在下面插入行",deleteColumn:"删除列",insertColumnLeft:"在左边插入列",insertColumnRight:"在右边插入列",deleteTable:"删除表格",title:"标题",normalText:"普通文本",underline:"下划线文字",alignment:"水平对齐",alignCenter:"居中",alignLeft:"居左",alignRight:"居右",selectLanguage:"选择程序语言",fontScale:"字体大小",fontScaleXLarge:"超大字体",fontScaleLarge:"大号字体",fontScaleNormal:"正常大小",fontScaleSmall:"小号字体",fontScaleXSmall:"超小字体"}},{}],26:[function(n,o,r){var i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.name="Indentation",n.opts={editor:null,tabIndent:!0},n.prototype._setOptions=function(e){return n.__super__._setOptions.apply(this,arguments),t.extend(this.opts,n.opts,e)},n.prototype._init=function(){return this.editor=this.opts.editor,this.editor.keystroke.add("tab","*",function(t){return function(e){var n;if(n=t.editor.toolbar.findButton("code"),t.opts.tabIndent||n&&n.active)return t.indent(e.shiftKey)}}(this))},n.prototype.indent=function(e){var n,o,r,i,s;return r=this.editor.selection.startNodes(),o=this.editor.selection.endNodes(),n=this.editor.selection.blockNodes(),i=[],n=n.each(function(e,n){var o,r,s,a,l;for(o=!0,r=s=0,a=i.length;s<a;r=++s){if(l=i[r],t.contains(n,l)){o=!1;break}if(t.contains(l,n)){i.splice(r,1,n),o=!1;break}}if(o)return i.push(n)}),n=t(i),s=!1,n.each(function(t){return function(n,o){var r;if(r=e?t.outdentBlock(o):t.indentBlock(o))return s=r}}(this)),s},n.prototype.indentBlock=function(e){var n,o,r,i,s,a,l,u,p,d;if(n=t(e),n.length){if(n.is("pre")){if(a=this.editor.selection.containerNode(),!a.is(n)&&!a.closest("pre").is(n))return;this.indentText(this.editor.selection.range())}else if(n.is("li")){if(s=n.prev("li"),s.length<1)return;this.editor.selection.save(),d=n.parent()[0].tagName,o=s.children("ul, ol"),o.length>0?o.append(n):t("<"+d+"/>").append(n).appendTo(s),this.editor.selection.restore()}else if(n.is("p, h1, h2, h3, h4"))p=parseInt(n.css("margin-left"))||0,p=(Math.round(p/this.opts.indentWidth)+1)*this.opts.indentWidth,n.css("margin-left",p);else{if(!n.is("table")&&!n.is(".qing-editor-table"))return!1;if(l=this.editor.selection.containerNode().closest("td, th"),r=l.next("td, th"),r.length>0||(u=l.parent("tr"),i=u.next("tr"),i.length<1&&u.parent().is("thead")&&(i=u.parent("thead").next("tbody").find("tr:first")),r=i.find("td:first, th:first")),!(l.length>0&&r.length>0))return;this.editor.selection.setRangeAtEndOf(r)}return!0}},n.prototype.indentText=function(t){var e,n;return e=t.toString().replace(/^(?=.+)/gm,"  "),n=document.createTextNode(e||"  "),t.deleteContents(),t.insertNode(n),e?(t.selectNode(n),this.editor.selection.range(t)):this.editor.selection.setRangeAfter(n)},n.prototype.outdentBlock=function(e){var n,o,r,i,s,a,l,u,p,d;if(n=t(e),n&&n.length>0){if(n.is("pre")){if(i=this.editor.selection.containerNode(),!i.is(n)&&!i.closest("pre").is(n))return;this.outdentText(d)}else if(n.is("li"))o=n.parent(),r=o.parent("li"),this.editor.selection.save(),r.length<1?(d=document.createRange(),d.setStartBefore(o[0]),d.setEndBefore(n[0]),o.before(d.extractContents()),t("<p/>").insertBefore(o).after(n.children("ul, ol")).append(n.contents()),n.remove()):(n.next("li").length>0&&t("<"+o[0].tagName+"/>").append(n.nextAll("li")).appendTo(n),n.insertAfter(r),o.children("li").length<1&&o.remove()),this.editor.selection.restore();else if(n.is("p, h1, h2, h3, h4"))p=parseInt(n.css("margin-left"))||0,p=Math.max(Math.round(p/this.opts.indentWidth)-1,0)*this.opts.indentWidth,n.css("margin-left",0===p?"":p);else{if(!n.is("table")&&!n.is(".qing-editor-table"))return!1;if(l=this.editor.selection.containerNode().closest("td, th"),s=l.prev("td, th"),s.length>0||(u=l.parent("tr"),a=u.prev("tr"),a.length<1&&u.parent().is("tbody")&&(a=u.parent("tbody").prev("thead").find("tr:first")),s=a.find("td:last, th:last")),!(l.length>0&&s.length>0))return;this.editor.selection.setRangeAtEndOf(s)}return!0}},n.prototype.outdentText=function(t){},n}(e),o.exports=i},{}],27:[function(n,o,r){var i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty,l=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.name="InputManager",n.opts={editor:null,tabIndent:!0},n.prototype._modifierKeys=[16,17,18,91,93,224],n.prototype._arrowKeys=[37,38,39,40],n.prototype._setOptions=function(e){return n.__super__._setOptions.apply(this,arguments),t.extend(this.opts,n.opts,e)},n.prototype._init=function(){var e,n;return this.editor=this.opts.editor,this.throttledValueChanged=this.editor.util.throttle(function(t){return function(e){return setTimeout(function(){return t.editor.trigger("valuechanged",e)},10)}}(this),300),this.throttledSelectionChanged=this.editor.util.throttle(function(t){return function(){return t.editor.trigger("selectionchanged")}}(this),50),t(document).on("selectionchange.qing-editor"+this.editor.id,function(t){return function(e){var n;if(t.focused&&!t.editor.clipboard.pasting)return(n=function(){return t._selectionTimer&&(clearTimeout(t._selectionTimer),t._selectionTimer=null),t.editor.selection._selection.rangeCount>0?t.throttledSelectionChanged():t._selectionTimer=setTimeout(function(){if(t._selectionTimer=null,t.focused)return n()},10)})()}}(this)),this.editor.on("valuechanged",function(e){return function(){var n;if(e.lastCaretPosition=null,n=e.editor.body.children().filter(function(t,n){return e.editor.util.isBlockNode(n)}),e.focused&&0===n.length&&(e.editor.selection.save(),e.editor.formatter.format(),e.editor.selection.restore()),e.editor.body.find("hr, pre, .qing-editor-table").each(function(n,o){var r,i;if(r=t(o),(r.parent().is("blockquote")||r.parent()[0]===e.editor.body[0])&&(i=!1,0===r.next().length&&(t("<p/>").append(e.editor.util.phBr).insertAfter(r),i=!0),0===r.prev().length&&(t("<p/>").append(e.editor.util.phBr).insertBefore(r),i=!0),i))return e.throttledValueChanged()}),e.editor.body.find("pre:empty").append(e.editor.util.phBr),!e.editor.util.support.onselectionchange&&e.focused)return e.throttledSelectionChanged()}}(this)),this.editor.body.on("keydown",t.proxy(this._onKeyDown,this)).on("keypress",t.proxy(this._onKeyPress,this)).on("keyup",t.proxy(this._onKeyUp,this)).on("mouseup",t.proxy(this._onMouseUp,this)).on("focus",t.proxy(this._onFocus,this)).on("blur",t.proxy(this._onBlur,this)).on("drop",t.proxy(this._onDrop,this)).on("input",t.proxy(this._onInput,this)),this.editor.util.browser.firefox&&(this.editor.hotkeys.add("cmd+left",function(t){return function(e){return e.preventDefault(),t.editor.selection._selection.modify("move","backward","lineboundary"),!1}}(this)),this.editor.hotkeys.add("cmd+right",function(t){return function(e){return e.preventDefault(),t.editor.selection._selection.modify("move","forward","lineboundary"),!1}}(this)),e=this.editor.util.os.mac?"cmd+a":"ctrl+a",this.editor.hotkeys.add(e,function(t){return function(e){var n,o,r,i;if(n=t.editor.body.children(),n.length>0)return o=n.first().get(0),r=n.last().get(0),i=document.createRange(),i.setStart(o,0),i.setEnd(r,t.editor.util.getNodeLength(r)),t.editor.selection.range(i),!1}}(this))),n=this.editor.util.os.mac?"cmd+enter":"ctrl+enter",this.editor.hotkeys.add(n,function(t){return function(e){return t.editor.el.closest("form").find("button:submit").click(),!1}}(this))},n.prototype._onFocus=function(t){if(!this.editor.clipboard.pasting)return this.editor.el.addClass("focus").removeClass("error"),this.focused=!0,setTimeout(function(t){return function(){var e,n;if(n=t.editor.selection._selection.getRangeAt(0),n.startContainer===t.editor.body[0]&&(t.lastCaretPosition?t.editor.undoManager.caretPosition(t.lastCaretPosition):(e=t.editor.body.children().first(),n=document.createRange(),t.editor.selection.setRangeAtStartOf(e,n))),t.lastCaretPosition=null,t.editor.trigger("focus"),!t.editor.util.support.onselectionchange)return t.throttledSelectionChanged()}}(this),0)},n.prototype._onBlur=function(t){var e;if(!this.editor.clipboard.pasting)return this.editor.el.removeClass("focus"),this.editor.sync(),this.focused=!1,this.lastCaretPosition=null!=(e=this.editor.undoManager.currentState())?e.caret:void 0,this.editor.trigger("blur")},n.prototype._onMouseUp=function(t){if(!this.editor.util.support.onselectionchange)return this.throttledSelectionChanged()},n.prototype._onKeyDown=function(t){var e,n;if(this.editor.trigger(t)===!1)return!1;if(!this.editor.hotkeys.respondTo(t)){if(this.editor.keystroke.respondTo(t))return this.throttledValueChanged(),!1;if(e=t.which,!(l.call(this._modifierKeys,e)>=0||(n=t.which,l.call(this._arrowKeys,n)>=0)||this.editor.util.metaKey(t)&&86===t.which))return this.editor.util.support.oninput||this.throttledValueChanged(["typing"]),null}},n.prototype._onKeyPress=function(t){if(this.editor.trigger(t)===!1)return!1},n.prototype._onKeyUp=function(e){var n,o;return this.editor.trigger(e)!==!1&&(!this.editor.util.support.onselectionchange&&(o=e.which,l.call(this._arrowKeys,o)>=0)?void this.throttledValueChanged():void(8!==e.which&&46!==e.which||!this.editor.util.isEmptyNode(this.editor.body)||(this.editor.body.empty(),n=t("<p/>").append(this.editor.util.phBr).appendTo(this.editor.body),this.editor.selection.setRangeAtStartOf(n))))},n.prototype._onDrop=function(t){return this.editor.trigger(t)!==!1&&this.throttledValueChanged()},n.prototype._onInput=function(t){return this.throttledValueChanged(["oninput"])},n}(e),o.exports=i},{}],28:[function(n,o,r){var i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.name="Keystroke",n.opts={editor:null},n.prototype._setOptions=function(e){return n.__super__._setOptions.apply(this,arguments),t.extend(this.opts,n.opts,e)},n.prototype._init=function(){return this.editor=this.opts.editor,this._keystrokeHandlers={},this._initKeystrokeHandlers()},n.prototype.add=function(t,e,n){return t=t.toLowerCase(),t=this.editor.hotkeys.constructor.aliases[t]||t,this._keystrokeHandlers[t]||(this._keystrokeHandlers[t]={}),this._keystrokeHandlers[t][e]=n},n.prototype.respondTo=function(e){var n,o,r,i;if(o=null!=(r=this.editor.hotkeys.constructor.keyNameMap[e.which])?r.toLowerCase():void 0)return!!(o in this._keystrokeHandlers&&(i="function"==typeof(n=this._keystrokeHandlers[o])["*"]?n["*"](e):void 0,i||this.editor.selection.startNodes().each(function(n){return function(r,s){var a,l;if(s.nodeType===Node.ELEMENT_NODE)return a=null!=(l=n._keystrokeHandlers[o])?l[s.tagName.toLowerCase()]:void 0,i="function"==typeof a?a(e,t(s)):void 0,i!==!0&&i!==!1&&void 0}}(this)),i))||void 0},n.prototype._initKeystrokeHandlers=function(){var e;return this.editor.util.browser.safari&&this.add("enter","*",function(e){return function(n){var o,r;if(n.shiftKey&&(o=e.editor.selection.blockNodes().last(),!o.is("pre")))return r=t("<br/>"),e.editor.selection.rangeAtEndOf(o)?(e.editor.selection.insertNode(r),e.editor.selection.insertNode(t("<br/>")),e.editor.selection.setRangeBefore(r)):e.editor.selection.insertNode(r),!0}}(this)),(this.editor.util.browser.webkit||this.editor.util.browser.msie)&&(e=function(e){return function(n,o){var r;if(e.editor.selection.rangeAtEndOf(o))return r=t("<p/>").append(e.editor.util.phBr).insertAfter(o),e.editor.selection.setRangeAtStartOf(r),!0}}(this),this.add("enter","h1",e),this.add("enter","h2",e),this.add("enter","h3",e),this.add("enter","h4",e),this.add("enter","h5",e),this.add("enter","h6",e)),this.add("backspace","*",function(t){return function(e){var n,o,r,i;return r=t.editor.selection.rootNodes().first(),o=r.prev(),o.is("hr")&&t.editor.selection.rangeAtStartOf(r)?(t.editor.selection.save(),o.remove(),t.editor.selection.restore(),!0):(n=t.editor.selection.blockNodes().last(),i=t.editor.util.browser.webkit,i&&t.editor.selection.rangeAtStartOf(n)?(t.editor.selection.save(),t.editor.formatter.cleanNode(n,!0),t.editor.selection.restore(),null):void 0)}}(this)),this.add("enter","li",function(e){return function(n,o){var r,i,s,a;if(r=o.clone(),r.find("ul, ol").remove(),e.editor.util.isEmptyNode(r)&&o.is(e.editor.selection.blockNodes().last())){if(i=o.parent(),o.next("li").length>0){if(!e.editor.util.isEmptyNode(o))return;i.parent("li").length>0?(s=t("<li/>").append(e.editor.util.phBr).insertAfter(i.parent("li")),a=t("<"+i[0].tagName+"/>").append(o.nextAll("li")),s.append(a)):(s=t("<p/>").append(e.editor.util.phBr).insertAfter(i),a=t("<"+i[0].tagName+"/>").append(o.nextAll("li")),s.after(a))}else i.parent("li").length>0?(s=t("<li/>").insertAfter(i.parent("li")),o.contents().length>0?s.append(o.contents()):s.append(e.editor.util.phBr)):(s=t("<p/>").append(e.editor.util.phBr).insertAfter(i),o.children("ul, ol").length>0&&s.after(o.children("ul, ol")));return o.prev("li").length?o.remove():i.remove(),e.editor.selection.setRangeAtStartOf(s),!0}}}(this)),this.add("enter","pre",function(e){return function(n,o){var r,i,s;return n.preventDefault(),n.shiftKey?(r=t("<p/>").append(e.editor.util.phBr).insertAfter(o),e.editor.selection.setRangeAtStartOf(r),!0):(s=e.editor.selection.range(),i=null,s.deleteContents(),!e.editor.util.browser.msie&&e.editor.selection.rangeAtEndOf(o)?(i=document.createTextNode("\n\n"),s.insertNode(i),s.setEnd(i,1)):(i=document.createTextNode("\n"),s.insertNode(i),s.setStartAfter(i)),s.collapse(!1),e.editor.selection.range(s),!0)}}(this)),this.add("enter","blockquote",function(t){return function(e,n){var o,r;if(o=t.editor.selection.blockNodes().last(),o.is("p")&&!o.next().length&&t.editor.util.isEmptyNode(o))return n.after(o),r=document.createRange(),t.editor.selection.setRangeAtStartOf(o,r),!0}}(this)),this.add("backspace","li",function(e){return function(n,o){var r,i,s,a,l,u,p,d,c;return i=o.children("ul, ol"),l=o.prev("li"),i.length>0&&l.length>0&&(c="",u=null,o.contents().each(function(e,n){if(1===n.nodeType&&/UL|OL/.test(n.nodeName))return!1;if(1!==n.nodeType||!/BR/.test(n.nodeName))return 3===n.nodeType&&n.nodeValue?c+=n.nodeValue:1===n.nodeType&&(c+=t(n).text()),u=t(n)}),p=e.editor.util.browser.firefox&&!u.next("br").length,u&&1===c.length&&p?(r=t(e.editor.util.phBr).insertAfter(u),u.remove(),e.editor.selection.setRangeBefore(r),!0):!(c.length>0)&&(d=document.createRange(),a=l.children("ul, ol"),a.length>0?(s=t("<li/>").append(e.editor.util.phBr).appendTo(a),a.append(i.children("li")),o.remove(),e.editor.selection.setRangeAtEndOf(s,d)):(e.editor.selection.setRangeAtEndOf(l,d),l.append(i),o.remove(),e.editor.selection.range(d)),!0))}}(this)),this.add("backspace","pre",function(e){return function(n,o){var r,i,s;if(e.editor.selection.rangeAtStartOf(o))return i=o.html().replace("\n","<br/>")||e.editor.util.phBr,r=t("<p/>").append(i).insertAfter(o),o.remove(),s=document.createRange(),e.editor.selection.setRangeAtStartOf(r,s),!0}}(this)),this.add("backspace","blockquote",function(t){return function(e,n){var o,r;if(t.editor.selection.rangeAtStartOf(n))return o=n.children().first().unwrap(),r=document.createRange(),t.editor.selection.setRangeAtStartOf(o,r),!0}}(this))},n}(e),o.exports=i},{}],29:[function(n,o,r){var i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.name="Selection",n.opts={editor:null},n.prototype._range=null,n.prototype._startNodes=null,n.prototype._endNodes=null,n.prototype._containerNode=null,n.prototype._nodes=null,n.prototype._blockNodes=null,n.prototype._rootNodes=null,n.prototype._setOptions=function(e){return n.__super__._setOptions.apply(this,arguments),t.extend(this.opts,n.opts,e)},n.prototype._init=function(){return this.editor=this.opts.editor,this._selection=document.getSelection(),this.editor.on("selectionchanged",function(t){return function(e){return t.reset(),t._range=t._selection.getRangeAt(0)}}(this)),this.editor.on("blur",function(t){return function(e){return t.reset()}}(this))},n.prototype.reset=function(){return this._range=null,this._startNodes=null,this._endNodes=null,this._containerNode=null,this._nodes=null,this._blockNodes=null,this._rootNodes=null},n.prototype.clear=function(){var t;try{this._selection.removeAllRanges()}catch(e){t=e}return this.reset()},n.prototype.range=function(t){var e;return t?(this.clear(),this._selection.addRange(t),this._range=t,e=this.editor.util.browser.firefox||this.editor.util.browser.msie,!this.editor.inputManager.focused&&e&&this.editor.body.focus()):!this._range&&this.editor.inputManager.focused&&this._selection.rangeCount&&(this._range=this._selection.getRangeAt(0)),this._range},n.prototype.startNodes=function(){return this._range&&(this._startNodes||(this._startNodes=function(e){return function(){var n;return n=t(e._range.startContainer).parentsUntil(e.editor.body).get(),n.unshift(e._range.startContainer),t(n)}}(this)())),this._startNodes},n.prototype.endNodes=function(){var e;return this._range&&(this._endNodes||(this._endNodes=this._range.collapsed?this.startNodes():(e=t(this._range.endContainer).parentsUntil(this.editor.body).get(),e.unshift(this._range.endContainer),t(e)))),this._endNodes},n.prototype.containerNode=function(){return this._range&&(this._containerNode||(this._containerNode=t(this._range.commonAncestorContainer))),this._containerNode},n.prototype.nodes=function(){return this._range&&(this._nodes||(this._nodes=function(e){return function(){var n;return n=[],e.startNodes().first().is(e.endNodes().first())?n=e.startNodes().get():(e.startNodes().each(function(o,r){var i,s,a,l,u,p,d;return s=t(r),e.endNodes().index(s)>-1?n.push(r):s.parent().is(e.editor.body)||(p=e.endNodes().index(s.parent()))>-1?(i=p&&p>-1?e.endNodes().eq(p-1):e.endNodes().last(),a=s.parent().contents(),d=a.index(s),l=a.index(i),t.merge(n,a.slice(d,l).get())):(a=s.parent().contents(),u=a.index(s),t.merge(n,a.slice(u).get()))}),e.endNodes().each(function(o,r){var i,s,a;return i=t(r),i.parent().is(e.editor.body)||e.startNodes().index(i.parent())>-1?(n.push(r),!1):(s=i.parent().contents(),a=s.index(i),t.merge(n,s.slice(0,a+1)))})),t(t.unique(n))}}(this)())),this._nodes},n.prototype.blockNodes=function(){if(this._range)return this._blockNodes||(this._blockNodes=function(t){return function(){return t.nodes().filter(function(e,n){return t.editor.util.isBlockNode(n)})}}(this)()),this._blockNodes},n.prototype.rootNodes=function(){if(this._range)return this._rootNodes||(this._rootNodes=function(e){return function(){return e.nodes().filter(function(n,o){var r;return r=t(o).parent(),r.is(e.editor.body)||r.is("blockquote")})}}(this)()),this._rootNodes},n.prototype.rangeAtEndOf=function(e,n){var o,r,i,s,a,l;if(null==n&&(n=this.range()),n&&n.collapsed)return e=t(e)[0],i=n.endContainer,s=this.editor.util.getNodeLength(i),r=n.endOffset===s-1,a=t(i).contents().last().is("br"),o=n.endOffset===s,!!(r&&a||o)&&(e===i||!!t.contains(e,i)&&(l=!0,t(i).parentsUntil(e).addBack().each(function(e,n){var o,r,i,s;if(s=t(n).parent().contents().filter(function(){return!(this!==n&&3===this.nodeType&&!this.nodeValue)}),o=s.last(),i=o.get(0)===n,r=o.is("br")&&o.prev().get(0)===n,!i&&!r)return l=!1,!1}),l))},n.prototype.rangeAtStartOf=function(e,n){var o,r;if(null==n&&(n=this.range()),n&&n.collapsed)return e=t(e)[0],r=n.startContainer,0===n.startOffset&&(e===r||!!t.contains(e,r)&&(o=!0,t(r).parentsUntil(e).addBack().each(function(e,n){var r;if(r=t(n).parent().contents().filter(function(){return!(this!==n&&3===this.nodeType&&!this.nodeValue)}),r.first().get(0)!==n)return o=!1}),o))},n.prototype.insertNode=function(e,n){if(null==n&&(n=this.range()),n)return e=t(e)[0],n.insertNode(e),this.setRangeAfter(e,n)},n.prototype.setRangeAfter=function(e,n){if(null==n&&(n=this.range()),null!=n)return e=t(e)[0],n.setEndAfter(e),n.collapse(!1),this.range(n)},n.prototype.setRangeBefore=function(e,n){if(null==n&&(n=this.range()),null!=n)return e=t(e)[0],n.setEndBefore(e),n.collapse(!1),this.range(n)},n.prototype.setRangeAtStartOf=function(e,n){return null==n&&(n=this.range()),e=t(e).get(0),n.setEnd(e,0),n.collapse(!1),this.range(n)},n.prototype.setRangeAtEndOf=function(e,n){var o,r,i,s,a,l,u;return null==n&&(n=this.range()),r=t(e),e=r[0],r.is("pre")?(i=r.contents(),i.length>0?(s=i.last(),l=s.text(),a=this.editor.util.getNodeLength(s[0]),"\n"===l.charAt(l.length-1)?n.setEnd(s[0],a-1):n.setEnd(s[0],a)):n.setEnd(e,0)):(u=this.editor.util.getNodeLength(e),3!==e.nodeType&&u>0&&(o=t(e).contents().last(),o.is("br")?u-=1:3!==o[0].nodeType&&this.editor.util.isEmptyNode(o)&&(o.append(this.editor.util.phBr),e=o[0],u=0)),n.setEnd(e,u)),n.collapse(!1),this.range(n)},n.prototype.deleteRangeContents=function(t){var e,n,o,r;return null==t&&(t=this.range()),r=t.cloneRange(),o=t.cloneRange(),r.collapse(!0),o.collapse(!1),n=this.rangeAtStartOf(this.editor.body,r),e=this.rangeAtEndOf(this.editor.body,o),!t.collapsed&&n&&e?(this.editor.body.empty(),t.setStart(this.editor.body[0],0),t.collapse(!0),this.range(t)):t.deleteContents(),t},n.prototype.breakBlockEl=function(e,n){var o;return null==n&&(n=this.range()),o=t(e),n.collapsed?(n.setStartBefore(o.get(0)),n.collapsed?o:o.before(n.extractContents())):o},n.prototype.save=function(e){var n,o,r;if(null==e&&(e=this.range()),!this._selectionSaved)return o=e.cloneRange(),o.collapse(!1),r=t("<span/>").addClass("qing-editor-caret-start"),n=t("<span/>").addClass("qing-editor-caret-end"),o.insertNode(n[0]),e.insertNode(r[0]),this.clear(),this._selectionSaved=!0},n.prototype.restore=function(){var t,e,n,o,r,i,s;return!!this._selectionSaved&&(r=this.editor.body.find(".qing-editor-caret-start"),t=this.editor.body.find(".qing-editor-caret-end"),r.length&&t.length?(i=r.parent(),s=i.contents().index(r),e=t.parent(),n=e.contents().index(t),i[0]===e[0]&&(n-=1),o=document.createRange(),o.setStart(i.get(0),s),o.setEnd(e.get(0),n),r.remove(),t.remove(),this.range(o)):(r.remove(),t.remove()),this._selectionSaved=!1,o)},n}(e),o.exports=i},{}],30:[function(n,o,r){var i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.name="Toolbar",n.opts={el:null,toolbar:!0,toolbarFloat:!0,toolbarHidden:!1,toolbarFloatOffset:0},n.prototype._tpl={wrapper:'<div class="qing-editor-toolbar"><ul></ul></div>',separator:'<li><span class="separator"></span></li>'},n.prototype._setOptions=function(e){return n.__super__._setOptions.apply(this,arguments),t.extend(this.opts,n.opts,e)},n.prototype._init=function(){var e,n,o;if(this.editor=this.opts.editor,this.opts.toolbar)return t.isArray(this.opts.toolbar)||(this.opts.toolbar=["bold","italic","underline","strikethrough","|","ol","ul","blockquote","code","|","link","image","|","indent","outdent"]),this._render(),this.list.on("click",function(t){return!1}),this.wrapper.on("mousedown",function(t){return function(e){return t.list.find(".menu-on").removeClass(".menu-on")}}(this)),t(document).on("mousedown.qing-editor"+this.editor.id,function(t){return function(e){return t.list.find(".menu-on").removeClass(".menu-on")}}(this)),!this.opts.toolbarHidden&&this.opts.toolbarFloat&&(this.wrapper.css("top",this.opts.toolbarFloatOffset),o=0,n=function(t){return function(){return t.wrapper.css("position","static"),t.wrapper.width("auto"),t.editor.util.reflow(t.wrapper),t.wrapper.width(t.wrapper.outerWidth()),t.wrapper.css("left",t.editor.util.os.mobile?t.wrapper.position().left:t.wrapper.offset().left),
t.wrapper.css("position",""),o=t.wrapper.outerHeight(),t.editor.placeholderEl.css("top",o),!0}}(this),e=null,t(window).on("resize.qing-editor-"+this.editor.id,function(t){return e=n()}),t(window).on("scroll.qing-editor-"+this.editor.id,function(r){return function(i){var s,a,l;if(r.wrapper.is(":visible"))if(l=r.editor.wrapper.offset().top,s=l+r.editor.wrapper.outerHeight()-80,a=t(document).scrollTop()+r.opts.toolbarFloatOffset,a<=l||a>=s){if(r.editor.wrapper.removeClass("toolbar-floating").css("padding-top",""),r.editor.util.os.mobile)return r.wrapper.css("top",r.opts.toolbarFloatOffset)}else if(e||(e=n()),r.editor.wrapper.addClass("toolbar-floating").css("padding-top",o),r.editor.util.os.mobile)return r.wrapper.css("top",a-l+r.opts.toolbarFloatOffset)}}(this))),this.editor.on("destroy",function(t){return function(){return t.buttons.length=0}}(this)),t(document).on("mousedown.qing-editor-"+this.editor.id,function(t){return function(e){return t.list.find("li.menu-on").removeClass("menu-on")}}(this))},n.prototype._render=function(){var e,n,o,r;for(this.buttons=[],this.wrapper=t(this._tpl.wrapper).prependTo(this.editor.wrapper),this.list=this.wrapper.find("ul"),r=this.opts.toolbar,e=0,n=r.length;e<n;e++)if(o=r[e],"|"!==o){if(!this.constructor.buttons[o])throw new Error("qing-editor: invalid toolbar button "+o);this.buttons.push(new this.constructor.buttons[o]({editor:this.editor,toolbar:this,locales:this.editor.locales}))}else t(this._tpl.separator).appendTo(this.list);if(this.opts.toolbarHidden)return this.wrapper.hide()},n.prototype.findButton=function(t){var e;return e=this.list.find(".toolbar-item-"+t).data("button"),null!=e?e:null},n.addButton=function(t){return this.buttons[t.prototype.name]=t},n.buttons={},n}(e),i.addButton(n("./buttons/alignment.coffee")),i.addButton(n("./buttons/blockquote.coffee")),i.addButton(n("./buttons/bold.coffee")),i.addButton(n("./buttons/code.coffee")),i.addButton(n("./buttons/color.coffee")),i.addButton(n("./buttons/font-scale.coffee")),i.addButton(n("./buttons/hr.coffee")),i.addButton(n("./buttons/image.coffee")),i.addButton(n("./buttons/indent.coffee")),i.addButton(n("./buttons/italic.coffee")),i.addButton(n("./buttons/link.coffee")),i.addButton(n("./buttons/order-list.coffee")),i.addButton(n("./buttons/unorder-list.coffee")),i.addButton(n("./buttons/outdent.coffee")),i.addButton(n("./buttons/popover.coffee")),i.addButton(n("./buttons/strikethrough.coffee")),i.addButton(n("./buttons/table.coffee")),i.addButton(n("./buttons/title.coffee")),i.addButton(n("./buttons/underline.coffee")),o.exports=i},{"./buttons/alignment.coffee":1,"./buttons/blockquote.coffee":2,"./buttons/bold.coffee":3,"./buttons/code.coffee":5,"./buttons/color.coffee":6,"./buttons/font-scale.coffee":7,"./buttons/hr.coffee":8,"./buttons/image.coffee":9,"./buttons/indent.coffee":10,"./buttons/italic.coffee":11,"./buttons/link.coffee":12,"./buttons/order-list.coffee":14,"./buttons/outdent.coffee":15,"./buttons/popover.coffee":16,"./buttons/strikethrough.coffee":17,"./buttons/table.coffee":18,"./buttons/title.coffee":19,"./buttons/underline.coffee":20,"./buttons/unorder-list.coffee":21}],31:[function(n,o,r){var i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.name="UndoManager",n.opts={el:null},n.prototype._index=-1,n.prototype._capacity=20,n.prototype._startPosition=null,n.prototype._endPosition=null,n.prototype._setOptions=function(e){return n.__super__._setOptions.apply(this,arguments),t.extend(this.opts,n.opts,e)},n.prototype._init=function(){var t,e;return this.editor=this.opts.editor,this._stack=[],this.editor.util.os.mac?(e="cmd+z",t="shift+cmd+z"):this.editor.util.os.win?(e="ctrl+z",t="ctrl+y"):(e="ctrl+z",t="shift+ctrl+z"),this.editor.hotkeys.add(e,function(t){return function(e){return e.preventDefault(),t.undo(),!1}}(this)),this.editor.hotkeys.add(t,function(t){return function(e){return e.preventDefault(),t.redo(),!1}}(this)),this.throttledPushState=this.editor.util.throttle(function(t){return function(){return t._pushUndoState()}}(this),2e3),this.editor.on("valuechanged",function(t){return function(e,n){if("undo"!==n&&"redo"!==n)return t.throttledPushState()}}(this)),this.editor.on("selectionchanged",function(t){return function(e){return t.resetCaretPosition(),t.update()}}(this)),this.editor.on("focus",function(t){return function(e){if(0===t._stack.length)return t._pushUndoState()}}(this)),this.editor.on("blur",function(t){return function(e){return t.resetCaretPosition()}}(this))},n.prototype.resetCaretPosition=function(){return this._startPosition=null,this._endPosition=null},n.prototype.startPosition=function(){return this.editor.selection._range&&(this._startPosition||(this._startPosition=this._getPosition("start"))),this._startPosition},n.prototype.endPosition=function(){return this.editor.selection._range&&(this._endPosition||(this._endPosition=function(t){return function(){var e;return e=t.editor.selection.range(),e.collapsed?t._startPosition:t._getPosition("end")}}(this)())),this._endPosition},n.prototype._pushUndoState=function(){var t;if(this.editor.trigger("pushundostate")!==!1&&(t=this.caretPosition(),t.start))return this._index+=1,this._stack.length=this._index,this._stack.push({html:this.editor.body.html(),caret:this.caretPosition()}),this._stack.length>this._capacity?(this._stack.shift(),this._index-=1):void 0},n.prototype.currentState=function(){return this._stack.length&&this._index>-1?this._stack[this._index]:null},n.prototype.undo=function(){var t;if(!(this._index<1||this._stack.length<2))return this.editor.hidePopover(),this._index-=1,t=this._stack[this._index],this.editor.body.get(0).innerHTML=t.html,this.caretPosition(t.caret),this.editor.body.find(".selected").removeClass("selected"),this.editor.sync(),this.editor.trigger("valuechanged",["undo"])},n.prototype.redo=function(){var t;if(!(this._index<0||this._stack.length<this._index+2))return this.editor.hidePopover(),this._index+=1,t=this._stack[this._index],this.editor.body.get(0).innerHTML=t.html,this.caretPosition(t.caret),this.editor.body.find(".selected").removeClass("selected"),this.editor.sync(),this.editor.trigger("valuechanged",["redo"])},n.prototype.update=function(){var t;if(t=this.currentState())return t.html=this.editor.body.html(),t.caret=this.caretPosition()},n.prototype._getNodeOffset=function(e,n){var o,r,i;return o=t.isNumeric(n)?t(e):t(e).parent(),i=0,r=!1,o.contents().each(function(t,o){return e!==o&&(n!==t||0!==t)&&(o.nodeType===Node.TEXT_NODE?!r&&o.nodeValue.length>0&&(i+=1,r=!0):(i+=1,r=!1),n-1!==t&&null)}),i},n.prototype._getPosition=function(e){var n,o,r,i,s,a,l;if(null==e&&(e="start"),l=this.editor.selection.range(),i=l[e+"Offset"],n=this.editor.selection[e+"Nodes"](),o=n.first()[0],o.nodeType===Node.TEXT_NODE){for(a=o.previousSibling;a&&a.nodeType===Node.TEXT_NODE;)o=a,i+=this.editor.util.getNodeLength(a),a=a.previousSibling;r=n.get(),r[0]=o,n=t(r)}else i=this._getNodeOffset(o,i);return s=[i],n.each(function(t){return function(e,n){return s.unshift(t._getNodeOffset(n))}}(this)),s},n.prototype._getNodeByPosition=function(e){var n,o,r,i,s,a,l,u;for(a=this.editor.body[0],u=e.slice(0,e.length-1),r=i=0,s=u.length;i<s;r=++i){if(l=u[r],o=a.childNodes,l>o.length-1){if(r!==e.length-2||!t(a).is("pre:empty")){a=null;break}n=document.createTextNode(""),a.appendChild(n),o=a.childNodes}a=o[l]}return a},n.prototype.caretPosition=function(t){var e,n,o,r,i;if(t){if(!t.start)return;return r=this._getNodeByPosition(t.start),i=t.start[t.start.length-1],t.collapsed?(e=r,n=i):(e=this._getNodeByPosition(t.end),n=t.start[t.start.length-1]),r&&e?(o=document.createRange(),o.setStart(r,i),o.setEnd(e,n),this.editor.selection.range(o)):void("undefined"!=typeof console&&null!==console&&"function"==typeof console.warn&&console.warn("qing-editor: invalid caret state"))}return o=this.editor.selection.range(),t=this.editor.inputManager.focused&&null!=o?{start:this.startPosition(),end:this.endPosition(),collapsed:o.collapsed}:{}},n}(e),o.exports=i},{}],32:[function(n,o,r){var i,s=function(t,e){function n(){this.constructor=t}for(var o in e)a.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},a={}.hasOwnProperty;i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return s(n,e),n.name="Util",n.prototype._init=function(){if(this.browser.msie&&this.browser.version<11)return this.phBr=""},n.prototype.phBr="<br/>",n.prototype.os=function(){var t;return t={},/Mac/.test(navigator.appVersion)?t.mac=!0:/Linux/.test(navigator.appVersion)?t.linux=!0:/Win/.test(navigator.appVersion)?t.win=!0:/X11/.test(navigator.appVersion)&&(t.unix=!0),/Mobi/.test(navigator.appVersion)&&(t.mobile=!0),t}(),n.prototype.browser=function(){var t,e,n,o,r,i,s,a,l,u,p;return p=navigator.userAgent,o=/(msie|trident)/i.test(p),t=/chrome|crios/i.test(p),u=/safari/i.test(p)&&!t,n=/firefox/i.test(p),e=/edge/i.test(p),o?{msie:!0,version:1*(null!=(r=p.match(/(msie |rv:)(\d+(\.\d+)?)/i))?r[2]:void 0)}:e?{edge:!0,webkit:!0,version:1*(null!=(i=p.match(/edge\/(\d+(\.\d+)?)/i))?i[1]:void 0)}:t?{webkit:!0,chrome:!0,version:1*(null!=(s=p.match(/(?:chrome|crios)\/(\d+(\.\d+)?)/i))?s[1]:void 0)}:u?{webkit:!0,safari:!0,version:1*(null!=(a=p.match(/version\/(\d+(\.\d+)?)/i))?a[1]:void 0)}:n?{mozilla:!0,firefox:!0,version:1*(null!=(l=p.match(/firefox\/(\d+(\.\d+)?)/i))?l[1]:void 0)}:{}}(),n.prototype.support=function(){return{onselectionchange:function(){var t,e;if(e=document.onselectionchange,void 0!==e)try{return document.onselectionchange=0,null===document.onselectionchange}catch(e){t=e}finally{document.onselectionchange=e}return!1}(),oninput:function(){return!/(msie|trident)/i.test(navigator.userAgent)}()}}(),n.prototype.reflow=function(e){return null==e&&(e=document),t(e)[0].offsetHeight},n.prototype.metaKey=function(t){var e;return e=/Mac/.test(navigator.userAgent),e?t.metaKey:t.ctrlKey},n.prototype.isEmptyNode=function(e){var n;return n=t(e),n.is(":empty")||!n.text()&&!n.find(":not(br, span, div)").length},n.prototype.isDecoratedNode=function(e){return t(e).is('[class^="qing-editor-"]')},n.prototype.blockNodes=["div","p","ul","ol","li","blockquote","hr","pre","h1","h2","h3","h4","h5","table"],n.prototype.isBlockNode=function(e){return e=t(e)[0],!(!e||3===e.nodeType)&&new RegExp("^("+this.blockNodes.join("|")+")$").test(e.nodeName.toLowerCase())},n.prototype.getNodeLength=function(e){switch(e=t(e)[0],e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}},n.prototype.dataURLtoBlob=function(t){var e,n,o,r,i,s,a,l,u,p,d,c,h;if(a=window.Blob&&function(){var t;try{return Boolean(new Blob)}catch(e){return t=e,!1}}(),s=a&&window.Uint8Array&&function(){var t;try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return t=e,!1}}(),e=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,h=a||e,!(h&&window.atob&&window.ArrayBuffer&&window.Uint8Array))return!1;for(i=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):decodeURIComponent(t.split(",")[1]),n=new ArrayBuffer(i.length),u=new Uint8Array(n),l=p=0,c=i.length;0<=c?p<=c:p>=c;l=0<=c?++p:--p)u[l]=i.charCodeAt(l);return d=t.split(",")[0].split(":")[1].split(";")[0],a?(r=s?u:n,new Blob([r],{type:d})):(o=new e,o.append(n),o.getBlob(d))},n.prototype.throttle=function(t,e){var n,o,r,i,s,a,l;return i=0,l=0,r=n=s=null,o=function(){return l=0,i=+new Date,s=t.apply(r,n),r=null,n=null},a=function(){var t;return r=this,n=arguments,t=new Date-i,l||(t>=e?o():l=setTimeout(o,e-t)),s},a.clear=function(){if(l)return clearTimeout(l),o()},a},n.prototype.formatHTML=function(e){var n,o,r,i,s,a,l,u,p;for(a=/<(\/?)(.+?)(\/?)>/g,u="",i=0,r=null,o="  ",l=function(t,e){return new Array(e+1).join(t)};null!==(s=a.exec(e));)s.isBlockNode=t.inArray(s[2],this.blockNodes)>-1,s.isStartTag="/"!==s[1]&&"/"!==s[3],s.isEndTag="/"===s[1]||"/"===s[3],n=r?r.index+r[0].length:0,(p=e.substring(n,s.index)).length>0&&t.trim(p)&&(u+=p),s.isBlockNode&&s.isEndTag&&!s.isStartTag&&(i-=1),s.isBlockNode&&s.isStartTag&&(r&&r.isBlockNode&&r.isEndTag||(u+="\n"),u+=l(o,i)),u+=s[0],s.isBlockNode&&s.isEndTag&&(u+="\n"),s.isBlockNode&&s.isStartTag&&(i+=1),r=s;return t.trim(u)},n}(e),o.exports=new i},{}],"qing-editor":[function(o,r,i){var s,a,l,u,p,d,c,h,f,g,m,y,_,v,b=function(t,e){function n(){this.constructor=t}for(var o in e)w.call(e,o)&&(t[o]=e[o]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},w={}.hasOwnProperty;_=o("./i18n.coffee"),v=o("./util.coffee"),u=o("./hotkeys.coffee"),d=o("./input-manager.coffee"),g=o("./selection.coffee"),y=o("./undo-manager.coffee"),c=o("./keystroke.coffee"),l=o("./formatter.coffee"),m=o("./toolbar.coffee"),p=o("./indentation.coffee"),a=o("./clipboard.coffee"),s=o("./buttons/button.coffee"),h=o("./buttons/popover.coffee"),f=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}return b(o,e),o.prototype.name="QingEditor",o.opts={el:null,placeholder:"",defaultImage:"images/image.png",params:{},upload:!1,indentWidth:40,pasteImage:!1,cleanPaste:!1,allowedTags:[],allowedAttributes:{},allowedStyles:{},tabIndent:!0,toolbar:!0,toolbarFloat:!0,toolbarHidden:!1,toolbarFloatOffset:0,locales:_},o.count=0,o._tpl='<div class="qing-editor">\n  <div class="qing-editor-wrapper">\n    <div class="qing-editor-placeholder"></div>\n    <div class="qing-editor-body" contenteditable="true">\n    </div>\n  </div>\n</div>',o.prototype._setOptions=function(e){return o.__super__._setOptions.apply(this,arguments),t.extend(this.opts,o.opts,e)},o.prototype._init=function(){var e,n,r;if(this.textarea=t(this.opts.el),this.opts.placeholder=this.opts.placeholder||this.textarea.attr("placeholder"),this.locales=this.opts.locales,this.util=v,!this.textarea.length)throw new Error("qing-editor: param el is required.");if(n=this.textarea.data("qing-editor"),null!=n&&n.destroy(),this.id=++o.count,this._render(),this._initChildComponents(),r=this.textarea.closest("form"),r.length&&(r.on("submit.qing-editor-"+this.id,function(t){return function(){return t.sync()}}(this)),r.on("reset.qing-editor-"+this.id,function(t){return function(){return t.setValue("")}}(this))),this.opts.placeholder&&this.on("valuechanged",function(t){return function(){return t._placeholder()}}(this)),this.setValue(this.textarea.val().trim()||""),this.textarea.attr("autofocus")&&this.focus(),this.util.browser.mozilla){this.util.reflow();try{return document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)}catch(t){e=t}}},o.prototype._render=function(){var e,n,r,i;if(this.el=t(o._tpl).insertBefore(this.textarea),this.wrapper=this.el.find(".qing-editor-wrapper"),this.body=this.wrapper.find(".qing-editor-body"),this.placeholderEl=this.wrapper.find(".qing-editor-placeholder").append(this.opts.placeholder),this.el.data("qingEditor",this),this.wrapper.append(this.textarea),this.textarea.data("qingEditor",this).blur(),this.body.attr("tabindex",this.textarea.attr("tabindex")),this.util.os.mac?this.el.addClass("qing-editor-mac"):this.util.os.linux&&this.el.addClass("qing-editor-linux"),this.util.os.mobile&&this.el.addClass("qing-editor-mobile"),this.opts.params){n=this.opts.params,r=[];for(e in n)i=n[e],r.push(t("<input/>",{type:"hidden",name:e,value:i}).insertAfter(this.textarea));return r}},o.prototype._initChildComponents=function(){var t;return this.hotkeys=new u({el:this.body}),this.opts.upload&&simpleUploader&&(t="object"==typeof this.opts.upload?this.opts.upload:{},this.uploader=new n(t)),this.inputManager=new d({editor:this,tabIndent:this.opts.tabIndent}),this.selection=new g({editor:this}),this.undoManager=new y({editor:this}),this.keystroke=new c({editor:this}),this.formatter=new l({editor:this,allowedTags:this.opts.allowedTags,allowedAttributes:this.opts.allowedAttributes,allowedStyles:this.opts.allowedStyles}),this.toolbar=new m({editor:this,toolbar:this.opts.toolbar,toolbarFloat:this.opts.toolbarFloat,toolbarHidden:this.opts.toolbarHidden,toolbarFloatOffset:this.opts.toolbarFloatOffset}),this.indentation=new p({tabIndent:this.opts.tabIndent,editor:this}),this.clipboard=new a({editor:this,pasteImage:this.opts.pasteImage,cleanPaste:this.opts.cleanPaste})},o.prototype._placeholder=function(){var t;return t=this.body.children(),0===t.length||1===t.length&&this.util.isEmptyNode(t)&&parseInt(t.css("margin-left")||0)<this.opts.indentWidth?this.placeholderEl.show():this.placeholderEl.hide()},o.prototype.setValue=function(t){return this.hidePopover(),this.textarea.val(t),this.body.get(0).innerHTML=t,this.formatter.format(),this.formatter.decorate(),this.util.reflow(this.body),this.inputManager.lastCaretPosition=null,this.trigger("valuechanged")},o.prototype.getValue=function(){return this.sync()},o.prototype.sync=function(){var e,n,o,r,i,s;for(n=this.body.clone(),this.formatter.undecorate(n),this.formatter.format(n),this.formatter.autolink(n),e=n.children(),i=e.last("p"),r=e.first("p");i.is("p")&&this.util.isEmptyNode(i);)o=i,i=i.prev("p"),o.remove();for(;r.is("p")&&this.util.isEmptyNode(r);)o=r,r=i.next("p"),o.remove();return n.find("img.uploading").remove(),s=t.trim(n.html()),this.textarea.val(s),s},o.prototype.focus=function(){var e,n;return this.body.is(":visible")&&this.body.is("[contenteditable]")?this.inputManager.lastCaretPosition?(this.undoManager.caretPosition(this.inputManager.lastCaretPosition),this.inputManager.lastCaretPosition=null):(e=this.body.children().last(),e.is("p")||(e=t("<p/>").append(this.util.phBr).appendTo(this.body)),n=document.createRange(),this.selection.setRangeAtEndOf(e,n)):void this.el.find("textarea:visible").focus()},o.prototype.blur=function(){return this.body.is(":visible")&&this.body.is("[contenteditable]")?this.body.blur():this.body.find("textarea:visible").blur()},o.prototype.hidePopover=function(){return this.el.find(".qing-editor-popover").each(function(e,n){if(n=t(n).data("popover"),n.active)return n.hide()})},o.prototype.destroy=function(){return this.trigger("destroy"),this.textarea.closest("form").off(".qing-editor .qing-editor-"+this.id),this.selection.clear(),this.inputManager.focused=!1,this.textarea.insertBefore(this.el).hide().val("").removeData("qingEditor"),this.el.remove(),t(document).off(".qing-editor-"+this.id),t(window).off(".qing-editor-"+this.id),this.off()},o}(e),f.Toolbar=m,f.Button=s,f.Popover=h,r.exports=f},{"./buttons/button.coffee":4,"./buttons/popover.coffee":16,"./clipboard.coffee":22,"./formatter.coffee":23,"./hotkeys.coffee":24,"./i18n.coffee":25,"./indentation.coffee":26,"./input-manager.coffee":27,"./keystroke.coffee":28,"./selection.coffee":29,"./toolbar.coffee":30,"./undo-manager.coffee":31,"./util.coffee":32}]},{},[]);return o("qing-editor")});